"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5101],{915(n,e,r){r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"projects/security-ticket/troubleshooting/custom-session-auth","title":"\ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d \uad6c\ud604","description":"Controller + SessionAuthenticationStrategy \uc870\ud569\uc73c\ub85c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ud1b5\ud569","source":"@site/docs/projects/security-ticket/troubleshooting/custom-session-auth.md","sourceDirName":"projects/security-ticket/troubleshooting","slug":"/projects/security-ticket/troubleshooting/custom-session-auth","permalink":"/docs/projects/security-ticket/troubleshooting/custom-session-auth","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"\ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d \uad6c\ud604"},"sidebar":"tutorialSidebar","previous":{"title":"MyBatis \uac80\uc0c9 \ucffc\ub9ac \ucd5c\uc801\ud654 (36% \uac1c\uc120)","permalink":"/docs/projects/security-ticket/troubleshooting/mybatis-optimization"},"next":{"title":"code_JPA-Specification","permalink":"/docs/projects/security-ticket/troubleshooting/code_JPA-Specification"}}');var t=r(4848),s=r(8453);const o={sidebar_position:2,title:"\ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d \uad6c\ud604"},l="Spring Security \ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d \uad6c\ud604",c={},a=[{value:"0. \uac1c\uc694",id:"0-\uac1c\uc694",level:2},{value:"1. \uad6c\ud604 \uacfc\uc815",id:"1-\uad6c\ud604-\uacfc\uc815",level:2},{value:"1-1) \uc778\uc99d \ud50c\ub85c\uc6b0",id:"1-1-\uc778\uc99d-\ud50c\ub85c\uc6b0",level:3},{value:"1-2) \uad6c\uc870 \uc124\uacc4",id:"1-2-\uad6c\uc870-\uc124\uacc4",level:3},{value:"1-3) Entity \uc0dd\uc131",id:"1-3-entity-\uc0dd\uc131",level:3},{value:"1-4) LoginService \uad6c\ud604",id:"1-4-loginservice-\uad6c\ud604",level:3},{value:"1-5) SessionConfig \uc124\uc815",id:"1-5-sessionconfig-\uc124\uc815",level:3},{value:"1-6) SecurityFilterChain \uc124\uc815",id:"1-6-securityfilterchain-\uc124\uc815",level:3},{value:"2. \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8 \uc124\uba85",id:"2-\ud575\uc2ec-\ucef4\ud3ec\ub10c\ud2b8-\uc124\uba85",level:2},{value:"1\ufe0f\u20e3 HttpSessionEventPublisher",id:"1\ufe0f\u20e3-httpsessioneventpublisher",level:3},{value:"2\ufe0f\u20e3 SessionRegistry",id:"2\ufe0f\u20e3-sessionregistry",level:3},{value:"3\ufe0f\u20e3 SessionAuthenticationStrategy",id:"3\ufe0f\u20e3-sessionauthenticationstrategy",level:3},{value:"3. \uad6c\ud604 \ud6a8\uacfc",id:"3-\uad6c\ud604-\ud6a8\uacfc",level:2},{value:"4. \ucd94\uac00 \uace0\ub824\uc0ac\ud56d",id:"4-\ucd94\uac00-\uace0\ub824\uc0ac\ud56d",level:2},{value:"\uad00\ub9ac\uc790 UI: \ud65c\uc131 \uc138\uc158 \uc870\ud68c",id:"\uad00\ub9ac\uc790-ui-\ud65c\uc131-\uc138\uc158-\uc870\ud68c",level:3},{value:"5. \ucc38\uace0 \uc790\ub8cc",id:"5-\ucc38\uace0-\uc790\ub8cc",level:2}];function u(n){const e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"spring-security-\ucee4\uc2a4\ud140-\uc138\uc158-\uc778\uc99d-\uad6c\ud604",children:"Spring Security \ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d \uad6c\ud604"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Controller + SessionAuthenticationStrategy \uc870\ud569\uc73c\ub85c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ud1b5\ud569"}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"0-\uac1c\uc694",children:"0. \uac1c\uc694"}),"\n",(0,t.jsx)(e.admonition,{title:"\ubb38\uc81c \uc0c1\ud669",type:"danger",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\uc11c\ubc84 \ud658\uacbd"}),": Admin/Customer \ud1b5\ud569 \ubaa8\ub180\ub9ac\ud2f1 \ud658\uacbd"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\uc694\uad6c\uc0ac\ud56d"}),":","\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"JSON \uae30\ubc18 \ub85c\uadf8\uc778 (\ud45c\uc900 FormLogin \ud544\ud130 \uc0ac\uc6a9 \ubd88\uac00)"}),"\n",(0,t.jsx)(e.li,{children:"\ub3d9\uc2dc \ub85c\uadf8\uc778 \uc81c\ud55c (\uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4)"}),"\n",(0,t.jsx)(e.li,{children:"\uacc4\uc815 \uc7a0\uae08, \uc2e4\ud328 \ud69f\uc218 \uc99d\uac00, \uccab \ub85c\uadf8\uc778 \uccb4\ud06c \ub4f1 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \ubc18\uc601"}),"\n",(0,t.jsx)(e.li,{children:"Admin/Customer \ud0c0\uc785\ubcc4 \ucee4\uc2a4\ud140 \uc751\ub2f5 \ud544\uc694"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(e.admonition,{title:"\ud574\uacb0 \ubc29\ud5a5",type:"tip",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\ud544\ud130 \ub300\uc2e0 ",(0,t.jsx)(e.strong,{children:"Controller + Service \ub808\uc774\uc5b4"}),"\uc5d0\uc11c \uc778\uc99d \ucc98\ub9ac"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"SessionAuthenticationStrategy"}),"\ub97c ",(0,t.jsx)(e.strong,{children:"\uc218\ub3d9 \ud638\ucd9c"}),"\ud558\uc5ec \uc138\uc158 \uc815\ucc45 \uc801\uc6a9"]}),"\n",(0,t.jsxs)(e.li,{children:["Spring Security\uc758 \uc138\uc158 \ud1b5\uc81c \uc815\ucc45\uc744 ",(0,t.jsx)(e.strong,{children:"heap stack \ubc29\uc2dd"}),"\uc73c\ub85c \uc6b0\ud68c"]}),"\n"]})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"1-\uad6c\ud604-\uacfc\uc815",children:"1. \uad6c\ud604 \uacfc\uc815"}),"\n",(0,t.jsx)(e.h3,{id:"1-1-\uc778\uc99d-\ud50c\ub85c\uc6b0",children:"1-1) \uc778\uc99d \ud50c\ub85c\uc6b0"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"1. [Client] Request\r\n    \u2193\r\n2. [Controller] \uc694\uccad \uc218\uc2e0\r\n    \u2193\r\n3. [LoginService] \uac80\uc99d\r\n    3.1 \uc0ac\uc6a9\uc790 \ud655\uc778\r\n    3.2 \uacc4\uc815 \ud65c\uc131 \uc5ec\ubd80\r\n    3.3 \ube44\ubc00\ubc88\ud638 \uac80\uc99d\r\n    3.4 \uccab \ub85c\uadf8\uc778 \uac80\uc99d\r\n    \u2193\r\n4. [performSecurityAuthentication]\r\n    4.1 AuthenticationManager.authenticate() \ud638\ucd9c\r\n    4.2 SessionAuthenticationStrategy.onAuthentication() \ud638\ucd9c\r\n        4.2.1 \uc911\ubcf5 \uc138\uc158 \uc81c\uc5b4\r\n        4.2.2 \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0\r\n        4.2.3 SessionRegistry \ub4f1\ub85d\r\n    4.3 SecurityContext \uc0dd\uc131 \ubc0f \uc124\uc815\r\n    4.4 HttpSession\uc5d0 SecurityContext \uc800\uc7a5\r\n    \u2193\r\n5. [Response]\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"1-2-\uad6c\uc870-\uc124\uacc4",children:"1-2) \uad6c\uc870 \uc124\uacc4"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"\uad6c\uc131\uc694\uc18c"}),(0,t.jsx)(e.th,{children:"\uc5ed\ud560"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"LoginController"})}),(0,t.jsx)(e.td,{children:"\uc0ac\uc6a9\uc790 \uc694\uccad \uc218\uc2e0, \ube44\uc988\ub2c8\uc2a4 \uac80\uc99d \ubc0f \uc778\uc99d \uc2e4\ud589"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"LoginService"})}),(0,t.jsx)(e.td,{children:"\uc0ac\uc6a9\uc790 \uac80\uc99d, \uacc4\uc815 \uc0c1\ud0dc \ud655\uc778, \uc138\uc158 \ub4f1\ub85d \ucc98\ub9ac"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"SessionAuthenticationStrategy"})}),(0,t.jsx)(e.td,{children:"\uc138\uc158 \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4 \ubc0f \ubcf4\uc548 \uc815\ucc45 \uc801\uc6a9"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"SecurityContextRepository"})}),(0,t.jsx)(e.td,{children:"\uc778\uc99d \uc815\ubcf4\uc758 \uc138\uc158 \uc800\uc7a5\uc18c \uad00\ub9ac"})]})]})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"1-3-entity-\uc0dd\uc131",children:"1-3) Entity \uc0dd\uc131"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Entity\r\n@Table(name = "users")\r\n@EqualsAndHashCode(of = "email", callSuper = false)  // \ucee4\uc2a4\ud140 \uc138\uc158 \uc694\uad6c\uc0ac\ud56d\r\npublic class User implements UserDetails {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(nullable = false, unique = true)\r\n    private String email;  // \uace0\uc720 \uc2dd\ubcc4\uc790\r\n\r\n    @Column(nullable = false)\r\n    private String password;\r\n\r\n    @Column(nullable = false)\r\n    private String name;\r\n\r\n    @Column\r\n    private LocalDateTime lastLoginAt;\r\n\r\n    @Column(nullable = false)\r\n    private int failedCount = 0;  // \ub85c\uadf8\uc778 \uc2e4\ud328 \ud69f\uc218\r\n\r\n    @Column(nullable = false)\r\n    private boolean isFirstLogin = true;  // \uccab \ub85c\uadf8\uc778 \uc5ec\ubd80\r\n\r\n    @Column(nullable = false)\r\n    private boolean isAccountNonLocked = true;  // \uacc4\uc815 \uc7a0\uae08 \uc5ec\ubd80\r\n\r\n    @Enumerated(EnumType.STRING)\r\n    private UserRole role;  // ADMIN, CLIENT\r\n\r\n    // UserDetails \uad6c\ud604\r\n    @Override\r\n    public Collection getAuthorities() {\r\n        return List.of(new SimpleGrantedAuthority("ROLE_" + role.name()));\r\n    }\r\n\r\n    @Override\r\n    public String getUsername() {\r\n        return email;\r\n    }\r\n\r\n    @Override\r\n    public boolean isAccountNonLocked() {\r\n        return isAccountNonLocked;\r\n    }\r\n\r\n    // \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\r\n    public void incrementFailed() {\r\n        this.failedCount++;\r\n        if (this.failedCount >= 5) {\r\n            this.isAccountNonLocked = false;\r\n        }\r\n    }\r\n\r\n    public void resetFailedCount() {\r\n        this.failedCount = 0;\r\n    }\r\n\r\n    public void updateLastLoginAt() {\r\n        this.lastLoginAt = LocalDateTime.now();\r\n    }\r\n\r\n    public boolean checkFirstLogin() {\r\n        return this.isFirstLogin;\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"1-4-loginservice-\uad6c\ud604",children:"1-4) LoginService \uad6c\ud604"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Service\r\n@Slf4j\r\n@RequiredArgsConstructor\r\npublic class LoginService {\r\n\r\n    private final CustomUserDetailsService customUserDetailsService;\r\n    private final PasswordEncoder passwordEncoder;\r\n    private final UserRepository userRepository;\r\n    private final AuthenticationManager authenticationManager;\r\n    private final SessionAuthenticationStrategy sessionAuthenticationStrategy;\r\n    private final HttpSessionSecurityContextRepository securityContextRepository;\r\n    private final SecurityContextHolderStrategy securityContextHolderStrategy =\r\n        SecurityContextHolder.getContextHolderStrategy();\r\n\r\n    public UserRole authenticateAndLogin(\r\n        LoginDto req,\r\n        HttpServletRequest request,\r\n        HttpServletResponse response\r\n    ) {\r\n        // 1. \uc0ac\uc6a9\uc790 \uc870\ud68c\r\n        User user = findUserOrThrow(req.getEmail());\r\n\r\n        // 2. \uacc4\uc815 \uc0c1\ud0dc \ud655\uc778\r\n        validateUserStatus(user);\r\n\r\n        // 3. \ube44\ubc00\ubc88\ud638 \uac80\uc99d\r\n        verifyPassword(req.getPassword(), user);\r\n\r\n        // 4. \uccab \ub85c\uadf8\uc778 \ud655\uc778\r\n        checkFirstLogin(user);\r\n\r\n        // 5. \ub85c\uadf8\uc778 \uc815\ubcf4 \uc5c5\ub370\uc774\ud2b8\r\n        updateLoginInfo(user);\r\n\r\n        // 6. Spring Security \uc778\uc99d \uc218\ud589\r\n        performSecurityAuthentication(req, user, request, response);\r\n\r\n        // 7. \uc0ac\uc6a9\uc790 \uc5ed\ud560 \ubc18\ud658 (Admin/Customer \uad6c\ubd84)\r\n        return resolveUserRole(user);\r\n    }\r\n\r\n    private User findUserOrThrow(String email) {\r\n        try {\r\n            return customUserDetailsService.loadUserByUsername(email);\r\n        } catch (Exception ex) {\r\n            throw new CustomException(ErrorCode.INVALID_USERNAME_OR_PASSWORD);\r\n        }\r\n    }\r\n\r\n    private void validateUserStatus(User user) {\r\n        if (!user.isAccountNonLocked()) {\r\n            throw new CustomException(ErrorCode.ACCOUNT_LOCKED);\r\n        }\r\n    }\r\n\r\n    private void verifyPassword(String rawPassword, User user) {\r\n        if (!passwordEncoder.matches(rawPassword, user.getPassword())) {\r\n            user.incrementFailed();\r\n            user.loginFail();\r\n            userRepository.save(user);\r\n\r\n            if (user.getFailedCount() >= 5) {\r\n                throw new CustomException(ErrorCode.ACCOUNT_LOCKED);\r\n            }\r\n\r\n            throw new CustomException(ErrorCode.INVALID_USERNAME_OR_PASSWORD);\r\n        }\r\n    }\r\n\r\n    private void checkFirstLogin(User user) {\r\n        if (user.checkFirstLogin()) {\r\n            throw new CustomException(ErrorCode.FIRST_LOGIN_REQUIRED);\r\n        }\r\n    }\r\n\r\n    private void updateLoginInfo(User user) {\r\n        user.resetFailedCount();\r\n        user.updateLastLoginAt();\r\n        userRepository.save(user);\r\n    }\r\n\r\n    /**\r\n     * Spring Security \uc778\uc99d \ud50c\ub85c\uc6b0 \uc218\ub3d9 \uc81c\uc5b4\r\n     */\r\n    private void performSecurityAuthentication(\r\n        LoginDto req,\r\n        User user,\r\n        HttpServletRequest request,\r\n        HttpServletResponse response\r\n    ) {\r\n        try {\r\n            // 1. AuthenticationManager\ub97c \ud1b5\ud55c \uc778\uc99d\r\n            UsernamePasswordAuthenticationToken authToken =\r\n                new UsernamePasswordAuthenticationToken(\r\n                    req.getEmail(),\r\n                    req.getPassword(),\r\n                    user.getAuthorities()\r\n                );\r\n\r\n            Authentication authentication = authenticationManager.authenticate(authToken);\r\n            log.debug("[\uc778\uc99d \uc131\uacf5] \uc0ac\uc6a9\uc790: {}", user.getEmail());\r\n\r\n            // 2. SessionAuthenticationStrategy \ud638\ucd9c (\uc138\uc158 \uc815\ucc45 \uc801\uc6a9)\r\n            sessionAuthenticationStrategy.onAuthentication(\r\n                authentication,\r\n                request,\r\n                response\r\n            );\r\n            log.debug("[\uc138\uc158 \uc815\ucc45 \uc801\uc6a9 \uc644\ub8cc] \uc0ac\uc6a9\uc790: {}", user.getEmail());\r\n\r\n            // 3. SecurityContext \uc0dd\uc131 \ubc0f \uc124\uc815\r\n            SecurityContext context = securityContextHolderStrategy.createEmptyContext();\r\n            context.setAuthentication(authentication);\r\n            SecurityContextHolder.setContext(context);\r\n\r\n            // 4. SecurityContext\ub97c \uc138\uc158\uc5d0 \uc800\uc7a5\r\n            securityContextRepository.saveContext(context, request, response);\r\n\r\n            HttpSession session = request.getSession(false);\r\n            String sessionId = session != null ? session.getId() : "Unknown";\r\n            log.info("[\uc778\uc99d \uc644\ub8cc] \uc0ac\uc6a9\uc790: {}, \uc138\uc158 ID: {}", user.getEmail(), sessionId);\r\n\r\n        } catch (SessionAuthenticationException ex) {\r\n            log.warn("[\uc138\uc158 \uc815\ucc45 \uc704\ubc18] \uc0ac\uc6a9\uc790: {}, \uc774\uc720: {}", user.getEmail(), ex.getMessage());\r\n            throw new CustomException(ErrorCode.SESSION_ALREADY_EXISTS);\r\n        } catch (Exception ex) {\r\n            log.error("[\uc778\uc99d \uc2e4\ud328] \uc0ac\uc6a9\uc790: {}, \uc774\uc720: {}", user.getEmail(), ex.getMessage(), ex);\r\n            throw new CustomException(ErrorCode.INTERNAL_SERVER_ERROR);\r\n        }\r\n    }\r\n\r\n    private UserRole resolveUserRole(User user) {\r\n        return (user.getClient() == null) ? UserRole.ADMIN : UserRole.CLIENT;\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"1-5-sessionconfig-\uc124\uc815",children:"1-5) SessionConfig \uc124\uc815"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Configuration\r\npublic class SessionConfig {\r\n\r\n    @Value("${server.servlet.session.timeout}")\r\n    private int sessionTimeout;\r\n\r\n    /**\r\n     * \uc138\uc158 \uc774\ubca4\ud2b8\ub97c Spring Security\uc5d0\uac8c \uc804\ub2ec\r\n     */\r\n    @Bean\r\n    public HttpSessionEventPublisher httpSessionEventPublisher() {\r\n        return new HttpSessionEventPublisher() {\r\n            @Override\r\n            public void sessionCreated(HttpSessionEvent event) {\r\n                String sessionId = event.getSession().getId();\r\n                event.getSession().setMaxInactiveInterval(sessionTimeout);\r\n                log.info("[\uc138\uc158 \uc0dd\uc131] sessionId: {}", sessionId);\r\n            }\r\n\r\n            @Override\r\n            public void sessionDestroyed(HttpSessionEvent event) {\r\n                String sessionId = event.getSession().getId();\r\n                log.info("[\uc138\uc158 \ub9cc\ub8cc] sessionId: {}", sessionId);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * HttpSessionEventPublisher \ub4f1\ub85d (SessionRegistry \ub3d9\uc791 \ubcf4\uc7a5)\r\n     */\r\n    @Bean\r\n    public ServletListenerRegistrationBean\r\n        httpSessionEventPublisherRegistration() {\r\n        return new ServletListenerRegistrationBean<>(httpSessionEventPublisher());\r\n    }\r\n\r\n    /**\r\n     * \ud65c\uc131 \uc138\uc158 \ucd94\uc801 \ubc0f \uad00\ub9ac\r\n     */\r\n    @Bean\r\n    public SessionRegistry sessionRegistry() {\r\n        return new SessionRegistryImpl() {\r\n            @Override\r\n            public void registerNewSession(String sessionId, Object principal) {\r\n                super.registerNewSession(sessionId, principal);\r\n                log.info("[\uc138\uc158 \ub4f1\ub85d] sessionId: {}, principal: {}",\r\n                         sessionId, extractPrincipalName(principal));\r\n            }\r\n\r\n            @Override\r\n            public void removeSessionInformation(String sessionId) {\r\n                super.removeSessionInformation(sessionId);\r\n                log.info("[\uc138\uc158 \uc81c\uac70] sessionId: {}", sessionId);\r\n            }\r\n\r\n            private String extractPrincipalName(Object principal) {\r\n                if (principal instanceof User user) {\r\n                    return user.getEmail();\r\n                }\r\n                return principal != null ? principal.toString() : "anonymous";\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * \ubcf5\ud569 \uc138\uc158 \uc778\uc99d \uc804\ub7b5 \uc124\uc815\r\n     * - \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4\r\n     * - \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0\r\n     * - \uc138\uc158 \ub808\uc9c0\uc2a4\ud2b8\ub9ac \ub4f1\ub85d\r\n     */\r\n    @Bean\r\n    public SessionAuthenticationStrategy sessionAuthenticationStrategy(\r\n        SessionRegistry sessionRegistry\r\n    ) {\r\n        // \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4\r\n        ConcurrentSessionControlAuthenticationStrategy concurrentStrategy =\r\n            new ConcurrentSessionControlAuthenticationStrategy(sessionRegistry);\r\n        concurrentStrategy.setMaximumSessions(1);  // \ub2e8\uc77c \uc138\uc158\ub9cc \ud5c8\uc6a9\r\n        concurrentStrategy.setExceptionIfMaximumExceeded(false);  // \uc774\uc804 \uc138\uc158 \ub9cc\ub8cc\r\n\r\n        // \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0\r\n        SessionFixationProtectionStrategy fixationStrategy =\r\n            new SessionFixationProtectionStrategy();\r\n\r\n        // \uc138\uc158 \ub4f1\ub85d\r\n        RegisterSessionAuthenticationStrategy registerStrategy =\r\n            new RegisterSessionAuthenticationStrategy(sessionRegistry);\r\n\r\n        // \uc804\ub7b5 \ud1b5\ud569\r\n        return new CompositeSessionAuthenticationStrategy(\r\n            List.of(\r\n                concurrentStrategy,\r\n                fixationStrategy,\r\n                registerStrategy\r\n            )\r\n        );\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"1-6-securityfilterchain-\uc124\uc815",children:"1-6) SecurityFilterChain \uc124\uc815"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Configuration\r\n@EnableWebSecurity\r\npublic class SecurityConfig {\r\n\r\n    @Bean\r\n    public SecurityFilterChain securityFilterChain(\r\n        HttpSecurity http,\r\n        SessionRegistry sessionRegistry\r\n    ) throws Exception {\r\n        http\r\n            .cors(cors -> cors.configurationSource(corsConfigurationSource()))\r\n            .csrf(csrf -> csrf.disable())\r\n            .authorizeHttpRequests(auth -> auth\r\n                .requestMatchers("/api/auth/**").permitAll()\r\n                .requestMatchers("/api/admin/**").hasRole("ADMIN")\r\n                .anyRequest().authenticated()\r\n            )\r\n            .securityContext(context -> context\r\n                .securityContextRepository(securityContextRepository())\r\n                .requireExplicitSave(true)\r\n            )\r\n            .sessionManagement(session -> session\r\n                .sessionFixation().changeSessionId()  // \uc138\uc158 ID \uc7ac\ubc1c\uae09\r\n                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)\r\n                .maximumSessions(1)  // \ub2e8\uc77c \uc138\uc158\r\n                .maxSessionsPreventsLogin(false)  // \uc774\uc804 \uc138\uc158 \ub9cc\ub8cc\r\n                .sessionRegistry(sessionRegistry)\r\n            )\r\n            .exceptionHandling(ex -> ex\r\n                .authenticationEntryPoint(authenticationDeniedHandler)\r\n                .accessDeniedHandler(authorizationDeniedHandler)\r\n            );\r\n\r\n        return http.build();\r\n    }\r\n\r\n    @Bean\r\n    public SecurityContextRepository securityContextRepository() {\r\n        return new HttpSessionSecurityContextRepository();\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"2-\ud575\uc2ec-\ucef4\ud3ec\ub10c\ud2b8-\uc124\uba85",children:"2. \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8 \uc124\uba85"}),"\n",(0,t.jsx)(e.h3,{id:"1\ufe0f\u20e3-httpsessioneventpublisher",children:"1\ufe0f\u20e3 HttpSessionEventPublisher"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\uc138\uc158 ",(0,t.jsx)(e.strong,{children:"\uc0dd\uc131/\uc0ad\uc81c \uc774\ubca4\ud2b8"}),"\ub97c \uac10\uc9c0\ud558\uc5ec Spring Security\uc5d0\uac8c \uc804\ub2ec"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"ServletListenerRegistrationBean"}),"\uc744 \ud1b5\ud574 \uc11c\ube14\ub9bf \ub9ac\uc2a4\ub108\uc5d0 \ub4f1\ub85d (\uc815\uc0c1 \ub3d9\uc791 \ubcf4\uc7a5)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\uc774\ubca4\ud2b8 \ud750\ub984"}),": \uc138\uc158 \uc774\ubca4\ud2b8 \u2192 SecurityContext \ucc98\ub9ac \u2192 SessionRegistry \ubc18\uc601"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"2\ufe0f\u20e3-sessionregistry",children:"2\ufe0f\u20e3 SessionRegistry"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\uc138\uc158 \ubc0f \uc0ac\uc6a9\uc790 \uc0c1\ud0dc \uad00\ub9ac \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8"}),"\n",(0,t.jsxs)(e.li,{children:["\ub85c\uadf8\uc778 \uc2dc \u2192 ",(0,t.jsx)(e.code,{children:"registerNewSession()"}),"\uc73c\ub85c \uc138\uc158 \ub4f1\ub85d"]}),"\n",(0,t.jsxs)(e.li,{children:["\ub85c\uadf8\uc544\uc6c3/\uc138\uc158 \ub9cc\ub8cc \uc2dc \u2192 ",(0,t.jsx)(e.code,{children:"removeSessionInformation()"}),"\uc73c\ub85c \uc815\ub9ac"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"extractPrincipalName()"})," \uae30\ubc18 \uc0ac\uc6a9\uc790 \uc2dd\ubcc4 \u2192 \ub85c\uae45 \ubc0f \uad00\ub9ac\uc790 UI\uc5d0\uc11c \ud65c\uc6a9"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"3\ufe0f\u20e3-sessionauthenticationstrategy",children:"3\ufe0f\u20e3 SessionAuthenticationStrategy"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\uc778\uc99d \uc131\uacf5 \uc2dc \uc791\ub3d9\ud558\ub294 \uc138\uc158 \uc815\ucc45 \uccb4\uc778"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"ConcurrentSessionControl"})," \u2192 ",(0,t.jsx)(e.strong,{children:"\ub3d9\uc2dc \ub85c\uadf8\uc778 \uac1c\uc218 \uc81c\ud55c"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"SessionFixationProtection"})," \u2192 ",(0,t.jsx)(e.strong,{children:"\uc138\uc158 ID \uc7ac\ubc1c\uae09"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"RegisterSessionAuthentication"})," \u2192 ",(0,t.jsx)(e.strong,{children:"SessionRegistry\uc5d0 \uc138\uc158 \ub4f1\ub85d"})]}),"\n",(0,t.jsxs)(e.li,{children:["\uc704 3\uac00\uc9c0 \uc804\ub7b5\uc744 ",(0,t.jsx)(e.strong,{children:"Composite \uc804\ub7b5\uc73c\ub85c \ud1b5\ud569 \uad6c\uc131"})]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"3-\uad6c\ud604-\ud6a8\uacfc",children:"3. \uad6c\ud604 \ud6a8\uacfc"}),"\n",(0,t.jsx)(e.admonition,{title:"\uc131\uacfc",type:"success",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["JSON \uae30\ubc18 ",(0,t.jsx)(e.strong,{children:"\ucee4\uc2a4\ud140 \ub85c\uadf8\uc778 API \uc644\uc131"})]}),"\n",(0,t.jsxs)(e.li,{children:["\ud45c\uc900 Form \ubc29\uc2dd\uc73c\ub85c \uad6c\ud604\uc774 \uc5b4\ub824\uc6e0\ub358 \ub85c\uc9c1\uc744 ",(0,t.jsx)(e.strong,{children:"\uc11c\ube44\uc2a4 \ub808\uc774\uc5b4\uc5d0\uc11c \uc720\uc5f0\ud558\uac8c \ucc98\ub9ac"})]}),"\n",(0,t.jsxs)(e.li,{children:["Spring Security\uc758 \uc138\uc158 \ud1b5\uc81c \uc815\ucc45\uc744 ",(0,t.jsx)(e.strong,{children:"\uc218\ub3d9 \ud638\ucd9c \ubc29\uc2dd\uc73c\ub85c \uc6b0\ud68c"})]}),"\n",(0,t.jsxs)(e.li,{children:["Admin/Customer ",(0,t.jsx)(e.strong,{children:"\ud65c\uc131 \uc138\uc158 UI \ud655\uc778 \uac00\ub2a5"})," (",(0,t.jsx)(e.code,{children:"SessionRegistry"})," \ud65c\uc6a9)"]}),"\n"]})}),"\n",(0,t.jsx)(e.admonition,{title:"\ubc30\uc6b4 \uc810",type:"tip",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"Spring Security \ub0b4\ubd80 \ub3d9\uc791 \uc774\ud574"})}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\ud45c\uc900 \ud544\ud130 \uccb4\uc778\uc744 \ubc97\uc5b4\ub09c \ucee4\uc2a4\ud140 \uc778\uc99d \uad6c\ud604"})," \uacbd\ud5d8"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"SessionAuthenticationStrategy \uc218\ub3d9 \ud638\ucd9c"}),"\uc758 \ud65c\uc6a9"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uacfc \uc778\uc99d \ub85c\uc9c1\uc758 \ud1b5\ud569"})," \uc804\ub7b5"]}),"\n"]})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"4-\ucd94\uac00-\uace0\ub824\uc0ac\ud56d",children:"4. \ucd94\uac00 \uace0\ub824\uc0ac\ud56d"}),"\n",(0,t.jsx)(e.h3,{id:"\uad00\ub9ac\uc790-ui-\ud65c\uc131-\uc138\uc158-\uc870\ud68c",children:"\uad00\ub9ac\uc790 UI: \ud65c\uc131 \uc138\uc158 \uc870\ud68c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("/api/admin/sessions")\r\npublic class SessionController {\r\n\r\n    private final SessionRegistry sessionRegistry;\r\n\r\n    @GetMapping\r\n    public ResponseEntity<List> getActiveSessions() {\r\n        List sessions = sessionRegistry.getAllPrincipals().stream()\r\n            .flatMap(principal -> sessionRegistry.getAllSessions(principal, false).stream())\r\n            .map(sessionInfo -> new SessionInfo(\r\n                sessionInfo.getSessionId(),\r\n                ((User) sessionInfo.getPrincipal()).getEmail(),\r\n                sessionInfo.getLastRequest()\r\n            ))\r\n            .toList();\r\n\r\n        return ResponseEntity.ok(sessions);\r\n    }\r\n\r\n    @DeleteMapping("/{sessionId}")\r\n    public ResponseEntity expireSession(@PathVariable String sessionId) {\r\n        SessionInformation sessionInfo = sessionRegistry.getSessionInformation(sessionId);\r\n        if (sessionInfo != null) {\r\n            sessionInfo.expireNow();\r\n        }\r\n        return ResponseEntity.ok().build();\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"5-\ucc38\uace0-\uc790\ub8cc",children:"5. \ucc38\uace0 \uc790\ub8cc"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.spring.io/spring-security/reference/servlet/authentication/session-management.html",children:"Spring Security - Session Management"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.spring.io/spring-security/reference/servlet/authentication/session-management.html#ns-concurrent-sessions",children:"Spring Security - Concurrent Session Control"})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}},8453(n,e,r){r.d(e,{R:()=>o,x:()=>l});var i=r(6540);const t={},s=i.createContext(t);function o(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);