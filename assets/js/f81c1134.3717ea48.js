"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[8130],{7735(n){n.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"spring-event-async-email-optimization","metadata":{"permalink":"/blog/spring-event-async-email-optimization","source":"@site/blog/posts/spring-event-async-email-optimization.md","title":"\uc774\uba54\uc77c \ubc1c\uc1a1 API \uc751\ub2f5 \uc18d\ub3c4 \uac1c\uc120: Spring Event\uc640 \ube44\ub3d9\uae30 \ucc98\ub9ac","description":"SMTP \ub3d9\uae30 \ud638\ucd9c\ub85c \uc778\ud574 2.5\ucd08 \uac78\ub9ac\ub358 \uc778\uc99d API\ub97c","date":"2025-12-10T00:00:00.000Z","tags":[],"hasTruncateMarker":false,"authors":[],"frontMatter":{"slug":"spring-event-async-email-optimization","title":"\uc774\uba54\uc77c \ubc1c\uc1a1 API \uc751\ub2f5 \uc18d\ub3c4 \uac1c\uc120: Spring Event\uc640 \ube44\ub3d9\uae30 \ucc98\ub9ac","date":"2025-12-10T00:00:00.000Z","categories":["Backend","Performance"],"tags":[]},"unlisted":false,"nextItem":{"title":"\ub808\ub514\uc2a4\ub294 \uc2f1\uae00\uc2a4\ub808\ub4dc\uc778\ub370 \uc65c \ub3d9\uc2dc\uc131 \uc81c\uc5b4\uac00 \ud544\uc694\ud560\uae4c?","permalink":"/blog/redis-concurrency"}},"content":"> SMTP \ub3d9\uae30 \ud638\ucd9c\ub85c \uc778\ud574 2.5\ucd08 \uac78\ub9ac\ub358 \uc778\uc99d API\ub97c <br/>\\r\\n> Spring Event\uc640 @Async\ub97c \ud65c\uc6a9\ud55c \ube44\ub3d9\uae30 \ucc98\ub9ac\ub85c **\uc751\ub2f5 \uc2dc\uac04\uc744 0.2\ucd08\ub85c \ub2e8\ucd95**\ud558\uace0, \ucc98\ub9ac\ub7c9\uc744 \ud5a5\uc0c1\uc2dc\ud0a8 \uacfc\uc815\uc785\ub2c8\ub2e4.\\r\\n\\r\\n## 1. \ubb38\uc81c \uc0c1\ud669(\ub3d9\uae30 \ube14\ub85c\ud0b9 \ubc29\uc2dd)\\r\\n\\r\\n### \ucd08\uae30 \ucf54\ub4dc\\r\\n\\r\\n- \ucc98\uc74c\uc5d0\ub294 **\uc800\uc7a5-\ubc1c\uc1a1**\uc5d0\ub9cc \ucd08\uc810\uc744 \ub9de\ucdb0 \uc544\ub798\uc640 \uac19\uc740 \ubc29\uc2dd\uc73c\ub85c \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n```java\\r\\npublic class VerificationService {\\r\\n\\r\\n    public void createAndSendCode(String email, VerificationType type) {\\r\\n        // 1. \uc778\uc99d \ucf54\ub4dc \uc0dd\uc131 \ubc0f Redis \uc800\uc7a5 (0.1\ucd08)\\r\\n        String code = generateRandomCode();\\r\\n        redisService.saveCode(email, code, type);\\r\\n\\r\\n        // 2. \uc774\uba54\uc77c \ubc1c\uc1a1 - SMTP \uc11c\ubc84 \uc751\ub2f5 \ub300\uae30\\r\\n        emailService.sendVerificationCode(email, code, type);\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n**\ubb38\uc81c\uc810**\\r\\n\\r\\n- `JavaMailSender.send()` \uba54\uc11c\ub4dc\ub294 Sync-Blocking\ubc29\uc2dd\\r\\n  1. SMTP \uc11c\ubc84\uac00 \uc751\ub2f5\ud560 \ub54c\uae4c\uc9c0 API \uc694\uccad \uc2a4\ub808\ub4dc\uac00 \ub300\uae30(\ube14\ub85c\ud0b9)\\r\\n  2. \uc0ac\uc6a9\uc790 \ub300\uae30 \uc2dc\uac04 \uc99d\uac00 (UX \uc545\ud654)\\r\\n  3. \ub3d9\uc2dc \uc694\uccad \uc2dc \ucc98\ub9ac\ub7c9 \uac10\uc18c\\r\\n  4. SMTP \uc11c\ubc84 \uc7a5\uc560 \uc2dc API \uc804\uccb4\uac00 \uc601\ud5a5\\r\\n\\r\\n## 2. \ud575\uc2ec \uac1c\ub150 \uc815\ub9ac\\r\\n\\r\\n> \ud574\uacb0\uc5d0 \uc55e\uc11c \ud544\uc694\ud55c **\ub3d9\uae30/\ube44\ub3d9\uae30**, **\ube14\ub85c\ud0b9/\ub17c\ube14\ub85c\ud0b9**, \uadf8\ub9ac\uace0 **ThreadPool**\uc758 \uac1c\ub150\uc744 \uba3c\uc800 \uc815\ub9ac\ud558\uaca0\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n### 1) \ub3d9\uae30 vs \ube44\ub3d9\uae30 (\uc81c\uc5b4\uad8c\uc758 \uad00\uc810)\\r\\n\\r\\n- **Sync-Blocking**: \ud638\ucd9c\ud55c \uc2a4\ub808\ub4dc\uac00 \uc791\uc5c5\uc774 \ub05d\ub0a0 \ub54c\uae4c\uc9c0 \uc81c\uc5b4\uad8c\uc744 \uc783\uace0 \ub300\uae30\\r\\n- **Async-NonBlocking**: \uc791\uc5c5\uc744 \ub2e4\ub978 \uc2a4\ub808\ub4dc\uc5d0 \uc704\uc784\ud558\uace0 \uc989\uc2dc \uc81c\uc5b4\uad8c\uc744 \ubc18\ud658\\r\\n\\r\\n- \uc2dc\uac04\uc774 \uac78\ub9ac\ub294 \uc791\uc5c5\uc758 \uacbd\uc6b0, **Async-NonBlocking**\ubc29\uc2dd\uc744 \ud1b5\ud574 \uc791\uc5c5\uc744 \ub358\uc9c0\uace0 \uc81c\uc5b4\uad8c\uc744 \ubc14\ub85c \ubc1b\uc544\uc57c \ud569\ub2c8\ub2e4.\\r\\n\\r\\n### 2) ThreadPool\uc774\ub780?\\r\\n\\r\\n- \uc694\uccad\ub9c8\ub2e4 \uc0c8\ub85c\uc6b4 \uc2a4\ub808\ub4dc\ub97c \uc0dd\uc131\ud558\uba74,\\r\\n- \uc2a4\ub808\ub4dc \uc0dd\uc131 \ube44\uc6a9 + \ucee8\ud14d\uc2a4\ud2b8 \uc2a4\uc704\uce6d \ube44\uc6a9\uc73c\ub85c \uc778\ud574 \uc131\ub2a5 \uc800\ud558\uac00 \ubc1c\uc0dd\\r\\n\\r\\n\u2192 \uc774\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 **\ubbf8\ub9ac \ub9cc\ub4e0 \uc2a4\ub808\ub4dc\ub97c \uc7ac\uc0ac\uc6a9\ud558\ub294 \uad6c\uc870\uac00 ThreadPool**\\r\\n\\r\\n#### \uc7a5\uc810:\\r\\n\\r\\n1. **\ub290\uc2a8\ud55c \uacb0\ud569**: Service\ub294 \uc774\uba54\uc77c\uc744 \uc5b4\ub5bb\uac8c \ubcf4\ub0b4\ub294\uc9c0 \ubab0\ub77c\ub3c4 \ub428\\r\\n2. **\ud655\uc7a5\uc131**: \ub2e4\ub978 \uc791\uc5c5\uc5d0 \ub300\ud574 \ub9ac\uc2a4\ub108\ub9cc \ud558\ub098 \ub354 \ub9cc\ub4e4\uba74 \ub05d\\r\\n3. **\uc7a5\uc560 \uaca9\ub9ac**: \uc774\uba54\uc77c \uc2e4\ud328\ud574\ub3c4 \ucf54\ub4dc \uc0dd\uc131\uc740 \uc131\uacf5\\r\\n\\r\\n### 3) Event-Driven Architecture \uc801\uc6a9\\r\\n\\r\\n- Spring\uc758 `ApplicationEventPublisher`\ub97c \uc0ac\uc6a9\ud558\uc5ec \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1(\uc778\uc99d \ucf54\ub4dc \uc0dd\uc131)\uacfc \ubd80\uac00 \ub85c\uc9c1(\uc774\uba54\uc77c \ubc1c\uc1a1)\uc744 \ubd84\ub9ac\ud569\ub2c8\ub2e4.\\r\\n- **\ubc1c\ud589(Publish):**\\r\\n  > \uc11c\ube44\uc2a4 \uacc4\uce35\uc5d0\uc11c \ud2b9\uc815 \uc774\ubca4\ud2b8\ub97c `publishEvent()`\ub97c \ud1b5\ud574 \ud2b8\ub9ac\uac70 \ud569\ub2c8\ub2e4.<br/>\\r\\n  > \uc774\ubca4\ud2b8 \ucc98\ub9ac \uc5ec\ubd80\uc640 \uc0c1\uad00\uc5c6\uc774 \uc989\uc2dc \uc751\ub2f5\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\\r\\n- **\uad6c\ub3c5(Subscribe):**\\r\\n  > `@EventListener`\ub97c \ud1b5\ud574 \ud2b9\uc815 \uc774\ubca4\ud2b8\uac00 \ud2b8\ub9ac\uac70 \ub418\uba74 \uc774\uc5d0 \ub300\ud55c \ucc98\ub9ac\ub97c \ud569\ub2c8\ub2e4.\\r\\n- **\ube44\ub3d9\uae30\ud654(Async):**\\r\\n\\r\\n  > \ub9ac\uc2a4\ub108 \uba54\uc11c\ub4dc\uc5d0 `@Async`\ub97c \ud1b5\ud574 \ube44\ub3d9\uae30 \uc791\uc5c5\uc784\uc744 \uba85\uc2dc\ud558\uace0, <br/>\\r\\n  > \ucee4\uc2a4\ud140\ud558\uc5ec, \uba54\uc778 \uc2a4\ub808\ub4dc\uac00 \uc544\ub2cc \ubcc4\ub3c4\uc758 \uc6cc\ucee4 \uc2a4\ub808\ub4dc\ub85c \ucc98\ub9ac\ud568\uc744 \uba85\uc2dc\ud569\ub2c8\ub2e4.\\r\\n\\r\\n- **Before:** Service\uac00 \uc9c1\uc811 \uc774\uba54\uc77c \ubc1c\uc1a1\\r\\n- **After:** Service\ub294 \\"\uc778\uc99d \ucf54\ub4dc \uc0dd\uc131\ub428\\" \uc774\ubca4\ud2b8\ub9cc \ubc1c\ud589\\r\\n\\r\\n## 3. \ud574\uacb0\uacfc\uc815\\r\\n\\r\\n### 1) \uc774\ubca4\ud2b8 \ud074\ub798\uc2a4\\r\\n\\r\\n> \uc6b0\ub9ac\uac00 \ucc98\ub9ac\ud560 \uc791\uc5c5\uc758 \ud2b8\ub9ac\uac70\uac00 \ub420 Event\ub97c \uba3c\uc800 \uc0dd\uc131\ud569\ub2c8\ub2e4.\\r\\n\\r\\n```java\\r\\npublic class VerificationCodeCreatedEvent extends ApplicationEvent {\\r\\n    private final String email;\\r\\n    private final String code;\\r\\n    private final VerificationType type;\\r\\n\\r\\n    public VerificationCodeCreatedEvent(\\r\\n        Object source,\\r\\n        String email,\\r\\n        String code,\\r\\n        VerificationType type\\r\\n    ) {\\r\\n        super(source);\\r\\n        this.email = email;\\r\\n        this.code = code;\\r\\n        this.type = type;\\r\\n    }\\r\\n\\r\\n    // getters\\r\\n}\\r\\n```\\r\\n\\r\\n### 2) \uc774\ubca4\ud2b8 \ubc1c\ud589 (Service \uacc4\uce35)\\r\\n\\r\\n> \ube44\uc988\ub2c8\uc2a4 \uc791\uc5c5\uc744 \ucc98\ub9ac\ud558\ub358 \uae30\uc874\uc758 Sevice\uacc4\uce35\uc5d0\uc11c\ub294 <br/>\\r\\n> \uc774\uc81c \uc774\ubca4\ud2b8 \ucc98\ub9ac\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc744 \uc54c \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.<br/>\\r\\n> \ub2e8\uc9c0, \uc774\ubca4\ud2b8\ub97c \ub358\uc9c0\uae30\ub9cc \ud569\ub2c8\ub2e4.\\r\\n\\r\\n```java\\r\\n@Service\\r\\n@RequiredArgsConstructor\\r\\npublic class VerificationService {\\r\\n    private final ApplicationEventPublisher eventPublisher;\\r\\n    private final RedisService redisService;\\r\\n\\r\\n    public void createAndSendCode(String email, VerificationType type) {\\r\\n        // 1. Redis\uc5d0 \uc778\uc99d \ucf54\ub4dc \uc800\uc7a5 (\ub3d9\uae30)\\r\\n        String code = generateRandomCode();\\r\\n        redisService.saveCode(email, code, type);\\r\\n\\r\\n        // 2. \uc774\ubca4\ud2b8 \ubc1c\ud589 (\ube44\ub3d9\uae30)\\r\\n        eventPublisher.publishEvent(\\r\\n            new VerificationCodeCreatedEvent(this, email, code, type)\\r\\n        );\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n### 3) \uc774\ubca4\ud2b8 \ub9ac\uc2a4\ub108 (\ube44\ub3d9\uae30 \ucc98\ub9ac)\\r\\n\\r\\n> `@Async()`\uc5b4\ub178\ud14c\uc158\uc5d0 \ucd94\uac00\ub85c `ThreadPoolTaskExecutor`\ub97c \uc124\uc815\ud558\uc5ec \uba54\uc778 \uc2a4\ub808\ub4dc\uac00 \uc544\ub2cc \uc6cc\ucee4 \uc2a4\ub808\ub4dc\ub97c \ud560\ub2f9 \ud569\ub2c8\ub2e4.\\r\\n\\r\\n```java\\r\\n@Component\\r\\npublic class VerificationCodeEventListener {\\r\\n    private final EmailService emailService;\\r\\n\\r\\n    @Async(\\"emailTaskExecutor\\")  // \ubcc4\ub3c4 \uc2a4\ub808\ub4dc \ud480\uc5d0\uc11c \uc2e4\ud589\\r\\n    @EventListener\\r\\n    public void handleVerificationCodeCreated(\\r\\n        VerificationCodeCreatedEvent event\\r\\n    ) {\\r\\n        try {\\r\\n            emailService.sendVerificationCode(\\r\\n                event.getEmail(),\\r\\n                event.getCode(),\\r\\n                event.getType()\\r\\n            );\\r\\n        } catch (Exception e) {\\r\\n            // \uc2e4\ud328 \uc2dc \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1 \ub610\ub294 \uc54c\ub9bc \ucc98\ub9ac\\r\\n        }\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n### 4) ThreadPoolTaskExecutor \uc124\uc815\\r\\n\\r\\n- `CorePoolSize` (\uae30\ubcf8 \uc2a4\ub808\ub4dc \uc218)\\r\\n- `MaxPoolSize` (\ucd5c\ub300 \uc2a4\ub808\ub4dc \uc218)\\r\\n- `QueueCapacity` (\ub300\uae30 \ud050 \ud06c\uae30)\\r\\n- `RejectedExecutionHandler`:\\r\\n  - \ucd5c\ub300 \uc2a4\ub808\ub4dc\uae4c\uc9c0 \ub2e4 \uc4f0\uace0 \ud050\ub3c4 \uaf49 \ucc3c\uc744 \ub54c \uc5b4\ub5bb\uac8c \ud560\uc9c0 \uacb0\uc815\ud569\ub2c8\ub2e4.\\r\\n  - `AbortPolicy` (\uae30\ubcf8\uac12): \uc608\uc678\ub97c \ub358\uc9c0\uace0 \uc791\uc5c5\uc744 \ubc84\ub9bd\ub2c8\ub2e4.\\r\\n  - `CallerRunsPolicy`: \ud050\uac00 \uaf49 \ucc28\uba74 \uc774\ubca4\ud2b8\ub97c \ubc1c\ud589\ud55c \uba54\uc778 \uc2a4\ub808\ub4dc\uac00 \uc9c1\uc811 \ucc98\ub9ac\ud569\ub2c8\ub2e4.\\r\\n\\r\\n- `ThreadNamePrefix`:\\r\\n  - \ub514\ubc84\uae45\uc744 \uc704\ud55c \ub124\uc774\ubc0d\uc785\ub2c8\ub2e4.\\r\\n\\r\\n```java\\r\\n@Configuration\\r\\n@EnableAsync\\r\\npublic class AsyncConfig {\\r\\n\\r\\n    @Bean(name = \\"emailTaskExecutor\\")\\r\\n    public Executor emailTaskExecutor() {\\r\\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\\r\\n        executor.setCorePoolSize(2);        // \uae30\ubcf8 \uc2a4\ub808\ub4dc \uc218\\r\\n        executor.setMaxPoolSize(5);         // \ucd5c\ub300 \uc2a4\ub808\ub4dc \uc218\\r\\n        executor.setQueueCapacity(100);     // \ub300\uae30 \ud050 \ud06c\uae30\\r\\n        executor.setThreadNamePrefix(\\"email-async-\\");\\r\\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());  // \ud050\uac00 \uaf49 \ucc3c\uc744 \ub54c: \ud638\ucd9c\ud55c \uc2a4\ub808\ub4dc\uac00 \uc9c1\uc811 \uc2e4\ud589\\r\\n        executor.initialize();\\r\\n        return executor;\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n#### ThreadPool \uc124\uc815\\r\\n\\r\\n    - \uc774\uba54\uc77c \ubc1c\uc1a1\uc740 CPU \uc5f0\uc0b0\ubcf4\ub2e4 SMTP \uc11c\ubc84\uc640\uc758 I/O \ub300\uae30 \uc2dc\uac04\uc774 \uae34 \uc791\uc5c5\uc774\uae30 \ub54c\ubb38\uc5d0\\r\\n    - \uc2a4\ub808\ub4dc \uc218\ub97c \ud06c\uac8c \uc7a1\uc9c0 \uc54a\uace0 \ucd08\uae30 \uc124\uc815 \ub2e8\uacc4\uc774\ubbc0\ub85c \uac12\uc744 \ucd5c\uc18c\ud654\ud588\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n#### \uc65c ThreadPoolTaskExecutor\ub97c \ubcc4\ub3c4\ub85c \uad00\ub9ac\ud574\uc57c \ud558\ub294\uac00?\\r\\n\\r\\n> `ThreadPool`\uc758 \uc124\uc815\uc740 \ub2e8\uc21c\ud788 \uba87 \uac1c\uc758 \uc2a4\ub808\ub4dc\ub97c \ub3cc\ub9b4\uc9c0\uc758 \ubb38\uc81c\uac00 \uc544\ub2cc \uc790\uc6d0\uc758 \ubc30\ubd84\uc5d0 \ub300\ud55c \uc124\uc815\uc785\ub2c8\ub2e4.<br/>\\r\\n> \ub2e8\uc21c\ud788 `@Async`\ub9cc \uc0ac\uc6a9\ud558\uace0 \uc124\uc815\uc744 \uc0dd\ub7b5\ud558\uba74, <br/>\\r\\n> \uc2a4\ud504\ub9c1\uc740 \uae30\ubcf8\uc801\uc73c\ub85c `SimpleAsyncTaskExecutor`\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.\\r\\n\\r\\n- **`SimpleAsyncTaskExecutor`\uc758 \uc704\ud5d8\uc131**\\r\\n  - \uc694\uccad\ub9c8\ub2e4 \uc0c8\ub85c\uc6b4 \uc2a4\ub808\ub4dc \uc0dd\uc131\\r\\n  - \uc2a4\ub808\ub4dc \uc7ac\uc0ac\uc6a9 X\\r\\n  - \ud2b8\ub798\ud53d \uc99d\uac00 \uc2dc, **OOM**\uc774 \ubc1c\uc0dd \uac00\ub2a5\\r\\n\\r\\n- **ThreadPool\uc744 \ubcc4\ub3c4\ub85c \uad00\ub9ac\ud558\uc5ec**\\r\\n  - \uba54\uc778 \uc2a4\ub808\ub4dc\uc640 \uc6cc\ucee4 \uc2a4\ub808\ub4dc\ub97c \uad6c\ubd84\ud558\uc5ec, \uc7a5\uc560 \uaca9\ub9ac\\r\\n  - `CorePoolSize`\uc640 `MaxPoolSize`\ub97c \ud1b5\ud574 \uc54c\ub9de\ub294 \uc790\uc6d0 \ud560\ub2f9\\r\\n  - `QueueCapacity`\ub97c \ud1b5\ud574 \ub300\uae30 \uc791\uc5c5\uc744 \uc548\uc804\ud558\uac8c \ubcf4\uad00\\r\\n\\r\\n### 5) \uc131\ub2a5 \uce21\uc815\\r\\n\\r\\n#### \uce21\uc815 \ubc29\ubc95\\r\\n\\r\\n- \ud14c\uc2a4\ud2b8 \ud658\uacbd: \ub85c\uceec Docker + Redis + Gmail SMTP / JMeter\\r\\n- JMeter\ub85c \ub3d9\uc2dc \uc0ac\uc6a9\uc790 50\uba85, \uac01 10\ud68c \uc694\uccad\\r\\n- API: POST /api/auth/email/verification\\r\\n\\r\\n| \ud56d\ubaa9                  | Before (\ub3d9\uae30) | After (\ube44\ub3d9\uae30) | \uac1c\uc120\uc728     |\\r\\n| --------------------- | ------------- | -------------- | ---------- |\\r\\n| **\ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04**     | 2.5\ucd08         | 0.2\ucd08          | **92% \u2193**  |\\r\\n| **95 percentile**     | 3.2\ucd08         | 0.3\ucd08          | **90% \u2193**  |\\r\\n| **\ucc98\ub9ac\ub7c9 (TPS)**      | 10 req/s      | 100+ req/s     | **10\ubc30 \u2191** |\\r\\n| **\ub3d9\uc2dc \ucc98\ub9ac \uac00\ub2a5 \uc218** | 10\uba85          | 100\uba85+         | **10\ubc30 \u2191** |\\r\\n\\r\\n## \ubcf4\uc644\uc810\\r\\n\\r\\n### 1) \uc774\ubca4\ud2b8 \ubc1c\ud589 \uc2dc, \ud2b8\ub79c\uc7ad\uc158 \ubb38\uc81c\\r\\n\\r\\n```java\\r\\n@Transactional\\r\\npublic void createAndSendCode(String email, VerificationType type) {\\r\\n    String code = generateRandomCode();\\r\\n    redisService.saveCode(email, code, type);  // 1) DB \uc800\uc7a5\\r\\n\\r\\n    eventPublisher.publishEvent(\\r\\n        new VerificationCodeCreatedEvent(this, email, code, type)\\r\\n    );\\r\\n}\\r\\n```\\r\\n\\r\\n- \uc774\ubca4\ud2b8 \ubc1c\ud589 \uc9c1\ud6c4, \uc608\uc678 \ubc1c\uc0dd \uc2dc \ub864\ubc31\\r\\n- \uc791\uc5c5 1)\uc774 \ubb34\uc2dc\ub418\uc5b4, \ucf54\ub4dc\uac00 \uc5c6\ub294 \uc774\uba54\uc77c\uc774 \ubc1c\uc1a1\\r\\n\\r\\n#### \ud574\uacb0\ucc45\\r\\n\\r\\n```java\\r\\n@Component\\r\\npublic class VerificationCodeEventListener {\\r\\n    private final EmailService emailService;\\r\\n\\r\\n    @Async(\\"emailTaskExecutor\\")  // \ubcc4\ub3c4 \uc2a4\ub808\ub4dc \ud480\uc5d0\uc11c \uc2e4\ud589\\r\\n    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)\\r\\n    public void handleVerificationCodeCreated(\\r\\n        VerificationCodeCreatedEvent event\\r\\n    ) {\\r\\n        try {\\r\\n            emailService.sendVerificationCode(\\r\\n                event.getEmail(),\\r\\n                event.getCode(),\\r\\n                event.getType()\\r\\n            );\\r\\n        } catch (Exception e) {\\r\\n            // \uc2e4\ud328 \uc2dc \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1 \ub610\ub294 \uc54c\ub9bc \ucc98\ub9ac\\r\\n        }\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n- \ub2e8\uc21c\ud788 `@EventListener`\uc5b4\ub178\ud14c\uc774\uc158\uc774 \uc544\ub2cc,\\r\\n- `@TransactionalEventListener`\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc774\uba54\uc77c \ubc1c\uc1a1\uc774 DB \uc800\uc7a5\ubcf4\ub2e4 \uba3c\uc800 \uc2e4\ud589\ub418\ub294 \ubb38\uc81c\ub97c \ubc29\uc9c0\\r\\n  - \ud2b8\ub79c\uc7ad\uc158\uc774 \ucee4\ubc0b\ub41c \uc774\ud6c4\uc5d0\ub9cc \uc774\ubca4\ud2b8\ub97c \ucc98\ub9ac\ud558\uae30 \ub54c\ubb38\\r\\n\\r\\n#### \uc8fc\uc758\uc810\\r\\n\\r\\n- `@Async`\ub098 `@Transactional`\uc740 Spring AOP \uae30\ubc18\uc73c\ub85c \ub3d9\uc791\\r\\n- **\uc790\uac00 \ud638\ucd9c** \uc2dc \ub3d9\uc791\ud558\uc9c0 \uc54a\uc74c\\r\\n  - \ub3d9\uc77c \ud074\ub798\uc2a4 \ub0b4\uc758 \uba54\uc11c\ub4dc \ud638\ucd9c \uc2dc,\\r\\n  - \ud504\ub85d\uc2dc \uac1d\uccb4\ub97c \uac70\uce58\uc9c0 \uc54a\uc544 `@Async`\uac00 \ub3d9\uc791\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c,\\r\\n  - \ubc18\ub4dc\uc2dc \ub9ac\uc2a4\ub108 \ud074\ub798\uc2a4\ub97c \ubcc4\ub3c4\uc758 `@Component`\ub85c \ubd84\ub9ac\ud558\uc5ec \ube48 \uc8fc\uc785\uc744 \ud1b5\ud574 \ud638\ucd9c\ud574\uc57c \ud568\\r\\n\\r\\n### 2) \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1 \uc5c6\uc74c\\r\\n\\r\\n> SMTP \uc11c\ubc84 \uc7a5\uc560\uc5d0 \ub300\ud55c \ub300\uc751\uc774 \uc5c6\uc74c\\r\\n\\r\\n#### \ud574\uacb0\ucc45\\r\\n\\r\\n`handleVerificationCodeCreated`\uc5d0 \ubc18\ubcf5\ubb38 + `try-catch`\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dc\ub3c4\ud69f\uc218 \ubc0f \uc2e4\ud328\ud69f\uc218 \uce74\uc6b4\ud305 \ubc0f \uc7ac\uc2dc\ub3c4 \ub85c\uc9c1 \ucd94\uac00 \ud544\uc694\\r\\n\\r\\n### 3) \uba54\uc138\uc9c0 \uc720\uc2e4 \ubc29\uc9c0\\r\\n\\r\\n> \ud604\uc7ac \uad6c\uc870\ub294 \uba54\uc778 \uc11c\ubc84\uac00 \uc8fd\uc73c\uba74 \uc774\ubca4\ud2b8\uac00 \ucd08\uae30\ud654<br/>\\r\\n> [\uc774\ubca4\ud2b8 \ubc1c\ud589] \u2192 [\uba54\ubaa8\ub9ac \ud050] \u2192 [\uc11c\ubc84 \uc167\ub2e4\uc6b4] \u2192 \uc774\ubca4\ud2b8 \uc720\uc2e4\\r\\n\\r\\n#### \ud574\uacb0\ucc45\\r\\n\\r\\n- RabbitMQ, Kafka \uac19\uc740 \uba54\uc2dc\uc9c0 \ube0c\ub85c\ucee4 \uc0ac\uc6a9\\r\\n- Dead Letter Queue(DLQ)\ub85c \uc2e4\ud328\ud55c \uba54\uc2dc\uc9c0 \ubcc4\ub3c4 \uad00\ub9ac\\r\\n\\r\\n#### \ucc38\uace0 \uc790\ub8cc\\r\\n\\r\\n- [Spring Framework - Event Publishing](https://docs.spring.io/spring-framework/reference/core/beans/context-introduction.html#context-functionality-events)\\r\\n- [Spring Framework - Task Execution and Scheduling](https://docs.spring.io/spring-framework/reference/integration/scheduling.html)"},{"id":"redis-concurrency","metadata":{"permalink":"/blog/redis-concurrency","source":"@site/blog/posts/redis-concurrency.md","title":"\ub808\ub514\uc2a4\ub294 \uc2f1\uae00\uc2a4\ub808\ub4dc\uc778\ub370 \uc65c \ub3d9\uc2dc\uc131 \uc81c\uc5b4\uac00 \ud544\uc694\ud560\uae4c?","description":"\ud504\ub85c\uc81d\ud2b8 GitHub","date":"2025-10-21T00:00:00.000Z","tags":[],"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"redis-concurrency","title":"\ub808\ub514\uc2a4\ub294 \uc2f1\uae00\uc2a4\ub808\ub4dc\uc778\ub370 \uc65c \ub3d9\uc2dc\uc131 \uc81c\uc5b4\uac00 \ud544\uc694\ud560\uae4c?","date":"2025-10-21T00:00:00.000Z","categories":["Redis","Concurrency","Backend"],"tags":[]},"unlisted":false,"prevItem":{"title":"\uc774\uba54\uc77c \ubc1c\uc1a1 API \uc751\ub2f5 \uc18d\ub3c4 \uac1c\uc120: Spring Event\uc640 \ube44\ub3d9\uae30 \ucc98\ub9ac","permalink":"/blog/spring-event-async-email-optimization"},"nextItem":{"title":"\uc774\uba54\uc77c \uc778\uc99d\uc5d0\uc11c Redis\uac00 \uac15\uc810\uc744 \uac16\ub294 \uc774\uc720: TTL\uacfc \uc6d0\uc790 \uc5f0\uc0b0","permalink":"/blog/redis-email-verification"}},"content":"[\ud504\ub85c\uc81d\ud2b8 GitHub](https://github.com/KKangHHee/redis-concurrency-test)\\r\\n\\r\\nRedis\ub294 **\uc2f1\uae00 \uc2a4\ub808\ub4dc \uae30\ubc18**\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4.  \\r\\n\uadf8\ub7f0\ub370 Redis\ub97c \uc0ac\uc6a9\ud560 \ub54c **\ub3d9\uc2dc\uc131 \uc81c\uc5b4** \uc774\uc57c\uae30\uac00 \ub098\uc624\ub294 \uac78 \ubcf4\uace0 \uc758\ubb38\uc774 \uc0dd\uacbc\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n> \\"\uc2f1\uae00 \uc2a4\ub808\ub4dc\uc778\ub370, \uc65c Race Condition\uc774 \uc0dd\uae30\uc9c0?\\"\\r\\n\\r\\n\uc774 \uae00\uc5d0\uc11c\ub294 \uc774\uc804 \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \ubc1c\uacac\ud55c \uc758\ubb38\uc810\uc744 \ubc14\ud0d5\uc73c\ub85c  \\r\\n\u2714 Redis\uc758 \uc2f1\uae00 \uc2a4\ub808\ub4dc \uad6c\uc870  \\r\\n\u2714 \ub3d9\uc2dc\uc131 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\ub294 \uadfc\ubcf8 \uc6d0\uc778  \\r\\n\u2714 Docker Compose\ub85c \uac80\uc99d\ud55c Before/After \ube44\uad50  \\r\\n\u2714 \uc548\uc804\ud558\uac8c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc744 \uae30\ub85d\ud569\ub2c8\ub2e4.\\r\\n\\r\\n---\\r\\n\\r\\n## 1. Redis\ub780 \ubb34\uc5c7\uc778\uac00?\\r\\n\\r\\nRedis(Remote Dictionary Server)\ub294 **\uba54\ubaa8\ub9ac \uae30\ubc18 Key-Value \uc800\uc7a5\uc18c**\uc785\ub2c8\ub2e4.\\r\\n\\r\\n### \u2714 \ud575\uc2ec \ud2b9\uc9d5\\r\\n\\r\\n| \ud2b9\uc9d5            | \uc124\uba85                                            |\\r\\n| --------------- | ----------------------------------------------- |\\r\\n| In-Memory       | RAM \uae30\ubc18\uc73c\ub85c \ub514\uc2a4\ud06c\ubcf4\ub2e4 \ub9e4\uc6b0 \ube60\ub984               |\\r\\n| Key-Value \uad6c\uc870  | \ub2e8\uc21c\ud55c \ub370\uc774\ud130 \ubaa8\ub378\ub85c \ube60\ub978 \uc811\uadfc                  |\\r\\n| \uc2f1\uae00 \uc2a4\ub808\ub4dc     | \uc774\ubca4\ud2b8 \ub8e8\ud504 \uae30\ubc18\uc73c\ub85c \ud55c \ubc88\uc5d0 \ud558\ub098\uc758 \uba85\ub839\ub9cc \ucc98\ub9ac |\\r\\n| \ub2e4\uc591\ud55c \uc790\ub8cc\uad6c\uc870 | String, Hash, List, Set, Sorted Set \ub4f1 \uc9c0\uc6d0     |\\r\\n\\r\\n### \u2714 \uc8fc\uc694 \uc0ac\uc6a9\ucc98\\r\\n\\r\\n- **\uce90\uc2dc**: DB \ubd80\ud558 \uac10\uc18c (\uc870\ud68c \uc131\ub2a5 \ud5a5\uc0c1)\\r\\n- **\uc138\uc158 \uad00\ub9ac**: \ub85c\uadf8\uc778 \uc0c1\ud0dc \uc720\uc9c0\\r\\n- **\uc778\uc99d \ucf54\ub4dc**: \uc774\uba54\uc77c/SMS \uc778\uc99d\ubc88\ud638 \uc800\uc7a5\\r\\n- **\uc2e4\uc2dc\uac04 \uce74\uc6b4\ud305**: \uc870\ud68c\uc218, \uc88b\uc544\uc694 \ub4f1\\r\\n\\r\\n---\\r\\n\\r\\n## 2. Redis\uc758 \uc2f1\uae00 \uc2a4\ub808\ub4dc \ubaa8\ub378\\r\\n\\r\\n### \u2714 Redis \ub0b4\ubd80 \ub3d9\uc791 \ubc29\uc2dd\\r\\n\\r\\n```text\\r\\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\r\\n\u2502 Client A    \u2502\u2500\u2500\u2500\u2510\\r\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\\r\\n                  \u25bc\\r\\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\r\\n\u2502 Client B    \u2502\u2500\u25b6\u2502  Command Queue   \u2502\\r\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\r\\n                          \u2502\\r\\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u25bc\\r\\n\u2502 Client C    \u2502\u2500\u2500\u2500\u25b6\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\r\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502 Event Loop   \u2502 \u2190 \uc2f1\uae00 \uc2a4\ub808\ub4dc\\r\\n                    \u2502 (\ud55c \ubc88\uc5d0 1\uac1c) \u2502\\r\\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\r\\n```\\r\\n\\r\\n> \ub0b4\ubd80\uc801\uc73c\ub85c \uc774\ubca4\ud2b8 \ub8e8\ud504 \uae30\ubc18 \uc2f1\uae00 \uc2a4\ub808\ub4dc\ub85c, \uba85\ub839\uc744 \ucc98\ub9ac\\r\\n\\r\\n1. \ud074\ub77c\uc774\uc5b8\ud2b8 \uc694\uccad\uc774 \ud050\uc5d0 \uc313\uc784\\r\\n2. Redis\ub294 \ud55c \ubc88\uc5d0 \ud558\ub098\uc758 \uba85\ub839\ub9cc \ucc98\ub9ac(\uac01 \uba85\ub839\uc740 \uc6d0\uc790\uc801)\\r\\n\\r\\n\u2192 \ub530\ub77c\uc11c `INCR`, `HINCRBY` \uac19\uc740 **\ub2e8\uc77c \uba85\ub839**\uc774 \uc911\uc694\\r\\n\\r\\n## 3. \uadf8\ub7fc \uc65c \ub3d9\uc2dc\uc131 \ubb38\uc81c\uac00 \uc0dd\uae38\uae4c?\\r\\n\\r\\n### \ubb38\uc81c: \\"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub808\ubca8\uc758 \ubd84\ub9ac\ub41c \uc5f0\uc0b0\\"\\r\\n\\r\\nRedis \uc790\uccb4\ub294 \uc2f1\uae00 \uc2a4\ub808\ub4dc\uc774\ubbc0\ub85c \uac01 \uba85\ub839\uc740 \uc6d0\uc790\uc801\uc73c\ub85c \ucc98\ub9ac\ub429\ub2c8\ub2e4.\\r\\n\ud558\uc9c0\ub9cc **\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc774 GET \u2192 Application \uacc4\uc0b0 \u2192 SET \uc21c\uc11c\ub85c \ubd84\ub9ac**\ub418\uc5b4 \uc788\ub2e4\uba74, \uc774 \uc0ac\uc774\uc5d0\ub294 \ub2e4\ub978 \uc11c\ubc84\uc758 \uc694\uccad\uc774 \ub07c\uc5b4\ub4e4 \uc218 \uc788\ub294 **Race Window\uac00 \ubc1c\uc0dd**\ud569\ub2c8\ub2e4.\\r\\n\\r\\n- \ube44\uad50 \ud504\ub85c\uc81d\ud2b8\ub97c \ud1b5\ud574 \uc54c\uc544\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4.\\r\\n- \ud658\uacbd\uc740 \uc774\uba54\uc77c\uc744 \ud0a4\ub85c \ud558\uc5ec, \ub3d9\uc77c \ud658\uacbd\uc5d0\uc11c Read-Modify-Write\uc640 HINCRBY\uc640 \uac19\uc740 \ub2e8\uc77c \ucc98\ub9ac\ub85c \ub098\ub220\uc11c \ube44\uad50\ud558\uc600\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n#### \uc798\ubabb\ub41c \uad6c\uc870 (Before)\\r\\n\\r\\n```java\\r\\nGET count\\r\\n+1\\r\\nSET count\\r\\n```\\r\\n\\r\\n- \uc5ec\ub7ec \uc11c\ubc84 \uc778\uc2a4\ud134\uc2a4\uac00 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub418\uba74\\r\\n- \uac19\uc740 \ud0a4\uc758 \uac12\uc744 \ubc14\uafbc\ub2e4 \ud560\ub54c,\\r\\n\\r\\n![image](../images/2025-10-21/app.before.png)\\r\\n\\r\\n> Docker Compose\ub85c **2\ub300 \uc11c\ubc84 + 12\ubc88 \ubcd1\ub82c \uc694\uccad**\uc744 \ubcf4\ub0c8\uc744 \ub54c: Lost Update \ubc1c\uc0dd\\r\\n\\r\\n- Redis\ub294 \uc2f1\uae00 \uc2a4\ub808\ub4dc\uc9c0\ub9cc \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uba40\ud2f0 \uc778\uc2a4\ud134\uc2a4\\r\\n- \uadf8\ub798\uc11c **RMW** \uad6c\uc870\ub294 **Lost Update** \ubb38\uc81c \ubc1c\uc0dd \uac00\ub2a5\\r\\n\\r\\n### \ud574\uacb0: Redis \uc6d0\uc790 \uc5f0\uc0b0 \uc0ac\uc6a9\\r\\n\\r\\n#### Redis\uc758 \uc6d0\uc790 \uc5f0\uc0b0 \uba85\ub839\\r\\n\\r\\n| \uba85\ub839\uc5b4            | \uc6a9\ub3c4                    | \uc608\uc2dc                    |\\r\\n| ----------------- | ----------------------- | ----------------------- |\\r\\n| `INCR` / `INCRBY` | \uc22b\uc790 \uc99d\uac00               | \uc870\ud68c\uc218, \uc88b\uc544\uc694 \uce74\uc6b4\ud2b8   |\\r\\n| `HINCRBY`         | Hash \ub0b4\ubd80 \uac12 \uc99d\uac00       | \uc0ac\uc6a9\uc790\ubcc4 \uc2dc\ub3c4 \ud69f\uc218 \uad00\ub9ac |\\r\\n| `SETNX`           | \ucd5c\ucd08 1\ud68c\ub9cc \uc124\uc815         | \ubd84\uc0b0 \ub77d \uad6c\ud604            |\\r\\n| `Lua Script`      | \uc5ec\ub7ec \uba85\ub839\uc744 \ud558\ub098\ub85c \ubb36\uc74c | \ubcf5\uc7a1\ud55c \uc870\uac74\ubd80 \ub85c\uc9c1      |\\r\\n\\r\\n#### \uc120\ud0dd \uae30\uc900\\r\\n\\r\\n```\\r\\n\ub2e8\uc21c \uc99d\uac00\ub9cc \ud544\uc694 \u2192 INCR / INCRBY\\r\\n\uc5ec\ub7ec \ud56d\ubaa9 \uad00\ub9ac \u2192 HINCRBY (Hash \uad6c\uc870)\\r\\n\uc870\uac74\ubd80 \ubcf5\uc7a1 \ub85c\uc9c1 \u2192 Lua Script\\r\\n```\\r\\n\\r\\n#### \ud574\uacb0 \uad6c\uc870 (after)\\r\\n\\r\\n```java\\r\\n        Long currentAttempts = redisTemplate.opsForHash().increment(key, \\"attemptCount\\", 1);\\r\\n```\\r\\n\\r\\n- Redis \ub0b4\ubd80\uc5d0\uc11c \ub2e8\uc77c \uba85\ub839\uc73c\ub85c \ucc98\ub9ac:\\r\\n  HINCRBY email:attempts user@example.com 1\\r\\n\\r\\n![image](../images/2025-10-21/app.after.png)\\r\\n\\r\\n> Docker Compose\ub85c **2\ub300 \uc11c\ubc84 + 12\ubc88 \ubcd1\ub82c \uc694\uccad**\uc744 \ubcf4\ub0c8\uc744 \ub54c: \uc815\ud655\ud55c \uce74\uc6b4\ud305\\r\\n\\r\\n- **\ub2e8\uc77c \uba85\ub839**\uc774\ubbc0\ub85c Redis\uc758 \uc2f1\uae00 \uc2a4\ub808\ub4dc \ud2b9\uc131\uc0c1 \uc808\ub300 \uc911\uac04\uc5d0 \ub07c\uc5b4\ub4e4 \uc218 \uc5c6\uc74c\\r\\n- \ubd84\uc0b0 \ud658\uacbd(\uc5ec\ub7ec \uc11c\ubc84)\uc5d0\uc11c\ub3c4 \uc548\uc804\\r\\n\\r\\n## 4. \uc815\ub9ac\\r\\n\\r\\n| \ud56d\ubaa9     | \ub0b4\uc6a9                                                                        |\\r\\n| -------- | --------------------------------------------------------------------------- |\\r\\n| **\ubb38\uc81c** | Redis\ub294 \uc2f1\uae00 \uc2a4\ub808\ub4dc\uc9c0\ub9cc, \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ubd84\ub9ac\ub41c \uc5f0\uc0b0\uc5d0\uc11c Race Condition \ubc1c\uc0dd |\\r\\n| **\uc6d0\uc778** | Read-Modify-Write\uc740 3\ub2e8\uacc4\uac00 \ubd84\ub9ac\ub418\uc5b4 \uc788\uc74c                                   |\\r\\n| **\ud574\uacb0** | HINCRBY \uac19\uc740 \uc6d0\uc790 \uc5f0\uc0b0 \uc0ac\uc6a9                                                 |\\r\\n| **\uac80\uc99d** | Docker Compose\ub85c 2\ub300 \uc11c\ubc84 \ud658\uacbd\uc5d0\uc11c 12\ubc88 \uc694\uccad \ud14c\uc2a4\ud2b8 \uc644\ub8cc                    |\\r\\n\\r\\n- Redis\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uace0 \ud574\uc11c \uc790\ub3d9\uc73c\ub85c \ub3d9\uc2dc\uc131 \ubb38\uc81c\uac00 \ud574\uacb0\ub418\ub294 \uac74 \uc544\ub2d9\ub2c8\ub2e4.\\r\\n- Read-Modify-Write \ubc29\uc2dd\uc73c\ub85c \uad6c\ud604\ud558\uba74 \uc5ec\uc804\ud788 Race Condition\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\r\\n- \ud2b8\ub79c\uc7ad\uc158 \ucc98\ub9ac\ucc98\ub7fc \uc798 \ubb36\uc5b4\uc11c \uc62c\ubc14\ub974\uac8c \uc0ac\uc6a9\ud558\ub294 \uac8c \uc911\uc694\ud569\ub2c8\ub2e4."},{"id":"redis-email-verification","metadata":{"permalink":"/blog/redis-email-verification","source":"@site/blog/posts/redis-email-verification.md","title":"\uc774\uba54\uc77c \uc778\uc99d\uc5d0\uc11c Redis\uac00 \uac15\uc810\uc744 \uac16\ub294 \uc774\uc720: TTL\uacfc \uc6d0\uc790 \uc5f0\uc0b0","description":"\\"\uc774\uba54\uc77c \uc778\uc99d \ucf54\ub4dc\ub294 \uc65c DB\uac00 \uc544\ub2cc Redis\uc5d0 \uc800\uc7a5\ud560\uae4c?\\"","date":"2025-10-10T00:00:00.000Z","tags":[],"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"redis-email-verification","title":"\uc774\uba54\uc77c \uc778\uc99d\uc5d0\uc11c Redis\uac00 \uac15\uc810\uc744 \uac16\ub294 \uc774\uc720: TTL\uacfc \uc6d0\uc790 \uc5f0\uc0b0","date":"2025-10-10T00:00:00.000Z","categories":["Redis","Backend","Security"],"tags":[]},"unlisted":false,"prevItem":{"title":"\ub808\ub514\uc2a4\ub294 \uc2f1\uae00\uc2a4\ub808\ub4dc\uc778\ub370 \uc65c \ub3d9\uc2dc\uc131 \uc81c\uc5b4\uac00 \ud544\uc694\ud560\uae4c?","permalink":"/blog/redis-concurrency"},"nextItem":{"title":"\ubcf5\uc7a1\ud55c \uac80\uc0c9 \ucffc\ub9ac, JPA vs MyBatis \uc131\ub2a5 \ube44\uad50\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5","permalink":"/blog/jpa-mybatis-hybrid-strategy"}},"content":"> \\"\uc774\uba54\uc77c \uc778\uc99d \ucf54\ub4dc\ub294 \uc65c DB\uac00 \uc544\ub2cc Redis\uc5d0 \uc800\uc7a5\ud560\uae4c?\\"\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n## 1. \uc774\uba54\uc77c \uc778\uc99d\uc758 \uc694\uad6c\uc0ac\ud56d\\r\\n\\r\\n#### \ube44\uc988\ub2c8\uc2a4 \uc694\uad6c\uc0ac\ud56d\\r\\n\\r\\n| \ud56d\ubaa9          | \uc694\uad6c\uc0ac\ud56d               | \uc774\uc720                  |\\r\\n| ------------- | ---------------------- | --------------------- |\\r\\n| **\ube60\ub978 \uc751\ub2f5** | \ube60\ub978 \uc751\ub2f5              | \uc0ac\uc6a9\uc790 \uacbd\ud5d8 (UX)      |\\r\\n| **\uc790\ub3d9 \ub9cc\ub8cc** | 5~10\ubd84 \ud6c4 \uc0ad\uc81c         | \ubcf4\uc548\uacfc \uba54\ubaa8\ub9ac \uc808\uc57d    |\\r\\n| **\uc2dc\ub3c4 \uc81c\ud55c** | 5\ud68c \ucd08\uacfc \uc2dc \ucc28\ub2e8       | \ubb34\ucc28\ubcc4 \ub300\uc785 \uacf5\uaca9 \ubc29\uc9c0 |\\r\\n| **\uc77c\uc2dc\uc131**    | \uc778\uc99d \uc644\ub8cc \ud6c4 \uc989\uc2dc \uc0ad\uc81c | \uac1c\uc778\uc815\ubcf4 \ucd5c\uc18c \ubcf4\uad00    |\\r\\n\\r\\n#### DB vs Redis \ube44\uad50\\r\\n\\r\\n| \uae30\uc900          | MySQL/PostgreSQL            | Redis                   |\\r\\n| ------------- | --------------------------- | ----------------------- |\\r\\n| **\uc77d\uae30 \uc18d\ub3c4** | \uc0c1\ub300\uc801\uc73c\ub85c \ub290\ub9bc(\ub514\uc2a4\ud06c I/O) | \uc0c1\ub300\uc801\uc73c\ub85c \ube60\ub984(\uba54\ubaa8\ub9ac) |\\r\\n| **TTL \uc9c0\uc6d0**  | \u274c                          | \u2705 (\uc790\ub3d9 \ub9cc\ub8cc)          |\\r\\n| **\ub3d9\uc2dc\uc131**    | Row Lock \ud544\uc694               | \uc6d0\uc790 \uc5f0\uc0b0 \uae30\ubcf8 \uc9c0\uc6d0     |\\r\\n| **\uc601\uc18d\uc131**    | \uc7a5\uae30 \ubcf4\uad00                   | RDB/AOF\ub85c \ubc31\uc5c5 \uac00\ub2a5     |\\r\\n\\r\\n- **\uc77c\uc2dc\uc801 \ub370\uc774\ud130 + \ube60\ub978 \uc18d\ub3c4 + \uc790\ub3d9 \ub9cc\ub8cc**\uc5d0\uc11c\ub294 **Redis\uac00 \uc555\ub3c4\uc801 \uc6b0\uc704**\\r\\n\\r\\n---\\r\\n\\r\\n## 2. Redis TTL\\r\\n\\r\\n#### DB\ub85c \uad6c\ud604 \uc2dc\\r\\n\\r\\n```sql\\r\\nCREATE TABLE email_codes (\\r\\n    email VARCHAR(255),\\r\\n    code VARCHAR(10),\\r\\n    expired_at TIMESTAMP\\r\\n);\\r\\n```\\r\\n\\r\\n- \uc870\ud68c\ud560 \ub54c\ub9c8\ub2e4 `expired_at > NOW()` \uc870\uac74 \uccb4\ud06c\\r\\n- \ubc30\uce58 \uc791\uc5c5\uc73c\ub85c \uc218\ub3d9 \uc0ad\uc81c \ud544\uc694 (\ucf54\ub4dc + \uc2a4\ucf00\uc904\ub7ec \uc124\uc815)\\r\\n- \ub9cc\ub8cc\ub41c \ub370\uc774\ud130\uac00 \uc989\uc2dc \uc0ad\uc81c\ub418\uc9c0 \uc54a\uc74c (\ub514\uc2a4\ud06c \uacf5\uac04 \ub0ad\ube44)\\r\\n\\r\\n#### redis\uc758 \uacbd\uc6b0\\r\\n\\r\\n```java\\r\\n// \uc778\uc99d \ucf54\ub4dc \uc800\uc7a5 + 10\ubd84 TTL \uc124\uc815\\r\\nredisTemplate.opsForValue()\\r\\n    .set(\\"email:code:\\" + email, code, 10, TimeUnit.MINUTES);\\r\\n```\\r\\n\\r\\n#### Redis\uac00 \ube60\ub978 \uc774\uc720\\r\\n\\r\\n- MySQL:\\r\\n  \uc694\uccad \u2192 \ub514\uc2a4\ud06c I/O \u2192 \uc778\ub371\uc2a4 \uac80\uc0c9 \u2192 Row Lock \u2192 \uacb0\uacfc \ubc18\ud658\\r\\n\\r\\n- Redis:\\r\\n  \uc694\uccad \u2192 \uba54\ubaa8\ub9ac \ud574\uc2dc \uc870\ud68c \u2192 \uacb0\uacfc \ubc18\ud658\\r\\n\\r\\n---\\r\\n\\r\\n## 3. Redis\ub97c \ud1b5\ud55c \uc774\uba54\uc77c \uc778\uc99d \uad6c\ud604\\r\\n\\r\\n#### \ub370\uc774\ud130 \uad6c\uc870 \uc124\uacc4\\r\\n\\r\\n```\\r\\nKey: email:verification:{email}\\r\\n\\r\\nFields:\\r\\n  - code: \\"A1B2C3\\"\\r\\n  - attempts: 3\\r\\n  - created_at: \\"2025-01-27T10:30:00\\"\\r\\n```\\r\\n\\r\\n**Hash \uad6c\uc870\uc758 \uc7a5\uc810**\\r\\n\\r\\n- **\ub370\uc774\ud130 \uc751\uc9d1\ub3c4**: \uac19\uc740 \uc774\uba54\uc77c\uc758 \ubaa8\ub4e0 \uc815\ubcf4\ub97c \ud55c \uacf3\uc5d0 \uad00\ub9ac\\r\\n- **\ubd80\ubd84 \uc5c5\ub370\uc774\ud2b8**: `code`\ub294 \uadf8\ub300\ub85c \ub450\uace0 `attempts`\ub9cc \uc99d\uac00 \uac00\ub2a5\\r\\n- **\uba54\ubaa8\ub9ac \ud6a8\uc728**: \uc791\uc740 Hash\ub294 Ziplist\ub85c \uc555\ucd95\ub418\uc5b4 \uba54\ubaa8\ub9ac \uc808\uc57d\\r\\n\\r\\n#### \ucf54\ub4dc \uad6c\ud604(java)\\r\\n\\r\\n```java\\r\\n@Service\\r\\n@RequiredArgsConstructor\\r\\npublic class EmailVerificationService {\\r\\n\\r\\n    private static final String KEY_PREFIX = \\"email:verification:\\"; // \ud0a4 \uad6c\uc870\\r\\n    private static final int MAX_ATTEMPTS = 5; // \ucd5c\ub300 \ud69f\uc218\\r\\n    private static final int CODE_EXPIRY_MINUTES = 10; // \ub9cc\ub8cc \uc2dc\uac04\\r\\n\\r\\n    private final RedisTemplate redisTemplate;\\r\\n\\r\\n    // 1) \uc778\uc99d \ucf54\ub4dc \uc0dd\uc131 \ubc0f \uc800\uc7a5(hash)\\r\\n    public String generateCode(String email) {\\r\\n        String code = generateRandomCode();\\r\\n        String key = KEY_PREFIX + email;\\r\\n\\r\\n        Map data = new HashMap<>();\\r\\n        data.put(\\"code\\", code);\\r\\n        data.put(\\"attempts\\", 0);\\r\\n        data.put(\\"created_at\\", LocalDateTime.now().toString());\\r\\n\\r\\n        redisTemplate.opsForHash().putAll(key, data);\\r\\n        redisTemplate.expire(key, CODE_EXPIRY_MINUTES, TimeUnit.MINUTES);\\r\\n\\r\\n        return code;\\r\\n    }\\r\\n\\r\\n    // 2) \uc778\uc99d \ucf54\ub4dc \uac80\uc99d(Redis \uc790\uccb4)\\r\\n    public boolean verify(String email, String inputCode) {\\r\\n        String key = KEY_PREFIX + email;\\r\\n\\r\\n        // 1. \ud0a4 \uc874\uc7ac \uc5ec\ubd80 \ud655\uc778\\r\\n        if (!Boolean.TRUE.equals(redisTemplate.hasKey(key))) {\\r\\n            throw new CodeExpiredException(\\"\uc778\uc99d \ucf54\ub4dc\uac00 \ub9cc\ub8cc\ub418\uc5c8\uac70\ub098 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\\");\\r\\n        }\\r\\n\\r\\n        // 2. \uc2dc\ub3c4 \ud69f\uc218 \uc99d\uac00\\r\\n        Long attempts = redisTemplate.opsForHash()\\r\\n            .increment(key, \\"attempts\\", 1);\\r\\n\\r\\n        // 3. \ucd5c\ub300 \uc2dc\ub3c4 \ud69f\uc218 \uccb4\ud06c\\r\\n        if (attempts > MAX_ATTEMPTS) {\\r\\n            throw new TooManyAttemptsException(\\r\\n                \\"\uc778\uc99d \uc2dc\ub3c4 \ud69f\uc218\uac00 \ucd08\uacfc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\\"\\r\\n            );\\r\\n        }\\r\\n\\r\\n        // 4. \ucf54\ub4dc \uc77c\uce58 \ud655\uc778\\r\\n        String storedCode = (String) redisTemplate.opsForHash()\\r\\n            .get(key, \\"code\\");\\r\\n\\r\\n        if (storedCode == null) {\\r\\n            throw new CodeExpiredException(\\"\uc778\uc99d \ucf54\ub4dc\uac00 \ub9cc\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\\");\\r\\n        }\\r\\n\\r\\n        boolean isValid = storedCode.equals(inputCode);\\r\\n\\r\\n        // 5. \uc778\uc99d \uc131\uacf5 \uc2dc \uc989\uc2dc \uc0ad\uc81c\\r\\n        if (isValid) {\\r\\n            redisTemplate.delete(key);\\r\\n        }\\r\\n\\r\\n        return isValid;\\r\\n    }\\r\\n\\r\\n    // 3) \uc7ac\ubc1c\uae09 \uc2dc, \uc774\uc804 \ucf54\ub4dc \ubb34\ud6a8\ud654\\r\\n    public String regenerateCode(String email) {\\r\\n        String key = KEY_PREFIX + email;\\r\\n        redisTemplate.delete(key);\\r\\n        return generateCode(email);\\r\\n    }\\r\\n\\r\\n    // 4) IP\ub2f9 1\ubd84\uc5d0 2\ubc88 \uc694\uccad \uac00\ub2a5\\r\\n    public void checkRateLimit(String ip) {\\r\\n        String key = \\"rate:limit:\\" + ip;\\r\\n        Long requests = redisTemplate.opsForValue().increment(key);\\r\\n\\r\\n        if (requests == 1) { // \uccab \uc694\uccad \uc2dc TTL \uc124\uc815\\r\\n        redisTemplate.expire(key, 1, TimeUnit.MINUTES);\\r\\n        }\\r\\n\\r\\n        if (requests > 2) {\\r\\n            throw new RateLimitExceededException(\\"\ub108\ubb34 \ub9ce\uc740 \uc694\uccad\uc785\ub2c8\ub2e4. 1\ubd84 \ud6c4 \ub2e4\uc2dc \uc2dc\ub3c4\ud558\uc138\uc694.\\");\\r\\n         }\\r\\n    }\\r\\n\\r\\n    // 5) \uc778\uc99d\ucf54\ub4dc \uc0dd\uc131\\r\\n    private String generateRandomCode() {\\r\\n        return RandomStringUtils.randomAlphanumeric(6).toUpperCase();\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n### \uc8fc\uc758\uc810 1) \ub9cc\ub8cc\ub41c \ud0a4\uc5d0 \ub300\ud55c `increment`\\r\\n\\r\\n```java\\r\\nLong attempts = redisTemplate.opsForHash()\\r\\n    .increment(key, \\"attempts\\", 1);\\r\\n```\\r\\n\\r\\n- \uc778\uc99d \ucf54\ub4dc\uac00 \ub9cc\ub8cc\ub418\uc5b4\ub3c4 \uacc4\uc18d \uac80\uc99d \uc694\uccad\uc774 \uc62c \uacbd\uc6b0,\\r\\n- \uc704\uc758 \ucf54\ub4dc\uc5d0\uc11c\ub294 \uc0c8\ub85c \ud0a4\ub97c \uc0dd\uc131\\r\\n\\r\\n**\uacb0\uacfc:**\\r\\n\\r\\n- `code` \ud544\ub4dc\ub294 \uc5c6\uace0 `attempts` \ud544\ub4dc\ub9cc \uc788\ub294 **\ud0a4** \uc0dd\uc131\\r\\n- TTL\ub3c4 \uc5c6\uc5b4\uc11c **\uc601\uc6d0\ud788 \uba54\ubaa8\ub9ac\uc5d0 \ub0a8\uc74c** (\uba54\ubaa8\ub9ac \ub204\uc218 \ubc1c\uc0dd)\\r\\n\\r\\n**\ud574\uacb0**\\r\\n\\r\\n```java\\r\\n// \ud0a4 \uc874\uc7ac \uc5ec\ubd80 \uba3c\uc800 \uccb4\ud06c\\r\\nif (!Boolean.TRUE.equals(redisTemplate.hasKey(key))) {\\r\\n    throw new CodeExpiredException(\\"\uc778\uc99d \ucf54\ub4dc\uac00 \ub9cc\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\\");\\r\\n}\\r\\n\\r\\n// \uc774\ud6c4 increment \uc2e4\ud589\\r\\n```\\r\\n\\r\\n### \uc8fc\uc758\uc810 2) Hash vs String \uad6c\uc870 \ube44\uad50\\r\\n\\r\\n- **Hash \uad6c\uc870\uc758 \uacbd\uc6b0**\\r\\n  - \ub370\uc774\ud130 \uc751\uc9d1\ub3c4 \uc88b\uc74c (\ud55c \uacf3\uc5d0 \ubaa8\ub4e0 \uc815\ubcf4)\\r\\n  - \ucf54\ub4dc\uc640 \uc2dc\ub3c4 \ud69f\uc218\ub294 \uac19\uc740 \uc0dd\uba85 \uc8fc\uae30\\r\\n  - \ubd80\ubd84 \uc5c5\ub370\uc774\ud2b8 \ud6a8\uc728\uc801\\r\\n  - **\uac1c\ubcc4 \ud544\ub4dc\uc5d0 \ub2e4\ub978 TTL\uc744 \uac78 \uc218 \uc5c6\uc74c**\\r\\n\\r\\n- **String \uad6c\uc870\uc758 \uacbd\uc6b0**\\r\\n  - \ud544\ub4dc\ub9c8\ub2e4 **\ub2e4\ub978 TTL**\uc774 \ud544\uc694\ud560 \ub54c\ub9cc \uace0\ub824\\r\\n\\r\\n---\\r\\n\\r\\n## 4. \uc815\ub9ac\\r\\n\\r\\n> \ub370\uc774\ud130\uc758 \uc0dd\uba85 \uc8fc\uae30\uac00 \uc9e7\uc740 \ub370\uc774\ud130(\uc778\uc99d \ucf54\ub4dc)\uc758 \uacbd\uc6b0 redis\uac00 \ucd5c\uc801\uc784\\r\\n\\r\\n- **\uc6b4\uc601 \ud6a8\uc728\uc131:**\\r\\n  \ubcc4\ub3c4\uc758 Batch \uc791\uc5c5\uc774\ub098 \uc2a4\ucf00\uc904\ub7ec \uc5c6\uc774\ub3c4 TTL\uc744 \ud1b5\ud574 \ub9cc\ub8cc \ub370\uc774\ud130\ub97c \uc790\ub3d9 \uc815\ub9ac\ud568\\r\\n- **\uc131\ub2a5 \ucd5c\uc801\ud654:**\\r\\n  \uc778\uc99d \uacfc\uc815\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \ube48\ubc88\ud55c \uc4f0\uae30/\uc77d\uae30 \uc791\uc5c5\uc774 \uba54\ubaa8\ub9ac \ub0b4\uc5d0\uc11c \ucc98\ub9ac\ub418\uc5b4 DB \ubd80\ud558\uac00 \uc5c6\uc74c\\r\\n- **\ubcf4\uc548:**\\r\\n  \uc6d0\uc790\uc801 \uc5f0\uc0b0\uc744 \ud65c\uc6a9\ud574 \ubd84\uc0b0 \ud658\uacbd\uc5d0\uc11c\ub3c4 \uc815\ud655\ud55c \uce74\uc6b4\ud305 \uac00\ub2a5\\r\\n- **\ube44\uc6a9 \uc808\uac10:**\\r\\n  \uc77c\uc2dc\uc801\uc778 \ub370\uc774\ud130\ub97c \uc704\ud574 RDB\uc758 \ucee4\ub125\uc158\uacfc \uc800\uc7a5 \uacf5\uac04\uc744 \ub0ad\ube44\ud558\uc9c0 \uc54a\uc74c"},{"id":"jpa-mybatis-hybrid-strategy","metadata":{"permalink":"/blog/jpa-mybatis-hybrid-strategy","source":"@site/blog/posts/jpa-mybatis-hybrid-strategy.md","title":"\ubcf5\uc7a1\ud55c \uac80\uc0c9 \ucffc\ub9ac, JPA vs MyBatis \uc131\ub2a5 \ube44\uad50\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5","description":"\\"\uad00\ub9ac\uc790 \ud398\uc774\uc9c0\uc758 \ubcf5\uc7a1\ud55c \uac80\uc0c9 \uae30\ub2a5 \uc5b4\ub5bb\uac8c \uad6c\ud604\ud560\uae4c?","date":"2025-04-28T00:00:00.000Z","tags":[],"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"jpa-mybatis-hybrid-strategy","title":"\ubcf5\uc7a1\ud55c \uac80\uc0c9 \ucffc\ub9ac, JPA vs MyBatis \uc131\ub2a5 \ube44\uad50\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5","date":"2025-04-28T00:00:00.000Z","categories":["Spring Boot","JPA","MyBatis","Performance"],"tags":[]},"unlisted":false,"prevItem":{"title":"\uc774\uba54\uc77c \uc778\uc99d\uc5d0\uc11c Redis\uac00 \uac15\uc810\uc744 \uac16\ub294 \uc774\uc720: TTL\uacfc \uc6d0\uc790 \uc5f0\uc0b0","permalink":"/blog/redis-email-verification"},"nextItem":{"title":"Spring Boot\uc5d0\uc11c Session \uc778\uc99d\uc744 \ucee4\uc2a4\ud140\ud558\ub294 \uc774\uc720\uc640 \uc2e4\uc804 \uad6c\ud604","permalink":"/blog/spring-boot-custom-session-authentication"}},"content":"> \\"\uad00\ub9ac\uc790 \ud398\uc774\uc9c0\uc758 \ubcf5\uc7a1\ud55c \uac80\uc0c9 \uae30\ub2a5 \uc5b4\ub5bb\uac8c \uad6c\ud604\ud560\uae4c?\\r\\n\\r\\n\uc774 \uae00\uc5d0\uc11c\ub294 \ub2e4\uc591\ud55c \ud544\ud130 \uc870\uac74\uc744 \uac00\uc9c4 \uac80\uc0c9 \uae30\ub2a5\uc744 \uad6c\ud604\ud558\uba70 **\uc21c\uc218 JPA \u2192 Native Query \u2192 JPA Specification \u2192 MyBatis**\ub85c \ubcc0\ud658\ud55c \uacfc\uc815\uacfc \uac01 \ubc29\uc2dd\uc758 \uc131\ub2a5\uc744 \uc2e4\uce21\ud55c \uacb0\uacfc\ub97c \uacf5\uc720\ud569\ub2c8\ub2e4.\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n---\\r\\n\\r\\n## 1. \ud504\ub85c\uc81d\ud2b8 \uc694\uad6c\uc0ac\ud56d\\r\\n\\r\\n### \uad00\ub9ac\uc790 \ud398\uc774\uc9c0\uc758 \uace0\uac1d \uac80\uc0c9 \uae30\ub2a5\\r\\n\\r\\n**\ube44\uc988\ub2c8\uc2a4 \uc694\uad6c\uc0ac\ud56d:**\\r\\n\\r\\n- \ub2e4\uc591\ud55c \ud544\ud130 \uc870\uac74 \uc9c0\uc6d0\\r\\n  - \uae30\uac04 \ud544\ud130 (\uac00\uc785\uc77c, \ucd5c\uc885 \ub85c\uadf8\uc778)\\r\\n  - \uacc4\uc815 \uc0c1\ud0dc (\ud65c\uc131/\ube44\ud65c\uc131/\uc7a0\uae40)\\r\\n  - \uad8c\ud55c\ubcc4 \ud544\ud130\\r\\n- \ud0a4\uc6cc\ub4dc \uac80\uc0c9 \ubc94\uc704\\r\\n  - \uc804\uccb4 \uac80\uc0c9 (\uc774\uba54\uc77c, \uc774\ub984, \uc18c\uc18d, \ubd80\uc11c, \uc5f0\ub77d\ucc98)\\r\\n  - \uac1c\ubcc4 \ud544\ub4dc \uac80\uc0c9\\r\\n- \ubc88\ud638 \uae30\ubc18 \ud398\uc774\uc9c0\ub124\uc774\uc158 (1, 2, 3... \ud398\uc774\uc9c0)\\r\\n\\r\\n### \uae30\uc220\uc801 \uc694\uad6c\uc0ac\ud56d\\r\\n\\r\\n**\uc131\ub2a5 \ubaa9\ud45c:**\\r\\n\\r\\n- \ub530\ub85c \uc81c\ud55c\uc740 \uc5c6\uc5c8\uc73c\ub098 \ub290\ub9b0 \uac83\uc744 \ud53c\ud558\uace0\uc790 \ud568\\r\\n\\r\\n**\uc720\uc9c0\ubcf4\uc218\uc131:**\\r\\n\\r\\n- \uc0c8\ub85c\uc6b4 \uac80\uc0c9 \uc870\uac74 \ucd94\uac00 \uc6a9\uc774\\r\\n- \ucffc\ub9ac \uac00\ub3c5\uc131 \ud655\ubcf4\\r\\n- \ud14c\uc2a4\ud2b8 \uac00\ub2a5\ud55c \uad6c\uc870\\r\\n\\r\\n---\\r\\n\\r\\n## 2. \uad6c\ud604 \uacfc\uc815\\r\\n\\r\\n### 1\ub2e8\uacc4: \uc21c\uc218 JPA Repository\\r\\n\\r\\n```java\\r\\npublic interface UserRepository extends JpaRepository {\\r\\n    Page findByClientCompanyNameContaining(String companyName, Pageable pageable);\\r\\n    Page findByLastLoginAtBetween(LocalDateTime start, LocalDateTime end, Pageable pageable);\\r\\n}\\r\\n```\\r\\n\\r\\n#### \ubb38\uc81c\uc810\\r\\n\\r\\n- \ud544\ud130\ub9c1 \uc870\uac74 \ub9c8\ub2e4\\r\\n  - **Repository \uba54\uc11c\ub4dc \uc99d\uac00** (\uc870\uac74 N\uac1c \u2192 2^N\uac1c)\\r\\n  - **Service\uc758 \ubd84\uae30 \ucc98\ub9ac \ubcf5\uc7a1**\\r\\n  - **\uac00\ub3c5\uc131\uacfc \uc720\uc9c0 \ubcf4\uc218\uc131\uc758 \uc800\ud558**\\r\\n\\r\\n---\\r\\n\\r\\n### 2\ub2e8\uacc4: Native Query\\r\\n\\r\\n> @Query \uc5b4\ub178\ud14c\uc774\uc158 \uc0ac\uc6a9\\r\\n\\r\\n#### \ubb38\uc81c\uc810\\r\\n\\r\\n- Native Query\ub97c \uc0ac\uc6a9\ud558\uc5ec,\\r\\n  - DB \uc885\uc18d (MySQL \uc804\uc6a9)\\r\\n  - \ub3d9\uc801 \uc870\uac74 \ucc98\ub9ac (IS NULL OR) \ube44\ud6a8\uc728\\r\\n  - \uc2e4\ud589 \uacc4\ud68d \ucd5c\uc801\ud654 \uc5b4\ub824\uc6c0\\r\\n    - **\uc2e4\ud589 \uacc4\ud68d \ubd84\uc11d:**\\r\\n\\r\\n    ```sql\\r\\n        EXPLAIN SELECT u.*\\r\\n        FROM user u\\r\\n        WHERE :keyword IS NULL OR u.email LIKE CONCAT(\'%\', :keyword, \'%\');\\r\\n    ```\\r\\n\\r\\n    - **\ubb38\uc81c\uc810:**\\r\\n      - MySQL \uc635\ud2f0\ub9c8\uc774\uc800\ub294 IS NULL OR \uc870\uac74\uc744 \ucd5c\uc801\ud654\ud558\uc9c0 \ubabb\ud568\\r\\n        - \uc778\ub371\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud558\uace0 Full Table Scan \ubc1c\uc0dd\\r\\n        - \ub370\uc774\ud130\uac00 \ub298\uc5b4\ub0a0\uc218\ub85d \uc131\ub2a5 \uc800\ud558\\r\\n\\r\\n---\\r\\n\\r\\n### 3\ub2e8\uacc4: JPA Specification\\r\\n\\r\\n**Repository \ud655\uc7a5:**\\r\\n\\r\\n```java\\r\\n// Specification \uc0ac\uc6a9\uc744 \uc704\ud574 \uc0c1\uc18d\ub9cc \ucd94\uac00\\r\\npublic interface UserRepository extends JpaRepository<User, Long>, JpaSpecificationExecutor<User> {}\\r\\n```\\r\\n\\r\\n**Specification \uad6c\ud604:**\\r\\n\\r\\n```java\\r\\npublic class UserSpecification {\\r\\n    public static Specification<User> filterClients(\\r\\n            LocalDate startDate,\\r\\n            LocalDate endDate,\\r\\n            String range,\\r\\n            String keyword) {\\r\\n\\r\\n        return (root, query, criteriaBuilder) -> {\\r\\n            List<Predicate> predicates = new ArrayList<>();\\r\\n\\t        ...\\r\\n        }\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n#### \uc7a5\uc810\\r\\n\\r\\n- **Fetch Join\uc744 \ub3d9\uc801\uc73c\ub85c \uc81c\uc5b4\ud558\uc5ec N+1 \ubb38\uc81c\ub97c \ud574\uacb0**\\r\\n- **ORM \uc77c\uad00\uc131 \uc720\uc9c0**\\r\\n\\r\\n#### \ub2e8\uc810\\r\\n\\r\\n- Java\uc640 SQL \ub85c\uc9c1 \ud63c\uc7ac\\r\\n- **\ubcf5\uc7a1\ud55c \ucffc\ub9ac \uc791\uc131\uc758 \uc5b4\ub824\uc6c0**\\r\\n- **\ucffc\ub9ac \ud29c\ub2dd\uc758 \uc5b4\ub824\uc6c0**\\r\\n  - \uc2e4\uc81c \uc2e4\ud589\ub418\ub294 SQL\uc744 \ubcf4\ub824\uba74 \ub85c\uadf8 \ud655\uc778 \ud544\uc694\\r\\n  - \uc2e4\ud589 \uacc4\ud68d \ubd84\uc11d\uc774 \uc5b4\ub824\uc6c0\\r\\n  - \uc778\ub371\uc2a4 \ud78c\ud2b8 \uc0ac\uc6a9 \ubd88\uac00\\r\\n\\r\\n#### \uc131\ub2a5 \ud14c\uc2a4\ud2b8 \uacb0\uacfc\\r\\n\\r\\n**\ud14c\uc2a4\ud2b8 \ud658\uacbd:**\\r\\n\\r\\n- JMeter (10\uba85 \ub3d9\uc2dc \uc811\uc18d, 50\ud68c \uc694\uccad| `GET /admin/clients`)\\r\\n- \ub370\uc774\ud130: User 1,050\uba85 (Admin 50 + Client 1,000)\\r\\n\\r\\n  | \uc2dc\ub098\ub9ac\uc624                   | \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04(ms) | \ucd5c\ub300(ms)  | \ucc98\ub9ac\ub7c9(TPS) |\\r\\n  | -------------------------- | ----------------- | --------- | ----------- |\\r\\n  | Search (\ud0a4\uc6cc\ub4dc \uac80\uc0c9)       | 20.99             | 77.33     | 55.93       |\\r\\n  | Date Filter (\ub0a0\uc9dc \ud544\ud130)    | 15.86             | 44.00     | 55.96       |\\r\\n  | Basic (\uae30\ubcf8 \ud398\uc774\uc9c0\ub124\uc774\uc158)  | 39.99             | 81.67     | 55.64       |\\r\\n  | Complex Filter (\ubcf5\ud569 \uc870\uac74) | 20.95             | 75.00     | 55.30       |\\r\\n  | **\ud3c9\uade0**                   | **24.45**         | **83.67** | **221.77**  |\\r\\n\\r\\n---\\r\\n\\r\\n## 3. MyBatis \ub3c4\uc785\\r\\n\\r\\n### \ub3c4\uc785 \ubc30\uacbd\\r\\n\\r\\n**\uc65c MyBatis\uc778\uac00?**\\r\\n\\r\\n1. SQL\uacfc Java \ucf54\ub4dc \uc644\uc804 \ubd84\ub9ac \u2192 \uac00\ub3c5\uc131 \ud5a5\uc0c1\\r\\n2. \ubcf5\uc7a1\ud55c \ub3d9\uc801 \ucffc\ub9ac \uc791\uc131 \uc6a9\uc774\\r\\n3. \ucffc\ub9ac \ud29c\ub2dd \ubc0f \uc2e4\ud589 \uacc4\ud68d \ubd84\uc11d \ud3b8\ub9ac\\r\\n4. \ud544\uc694\ud55c \uceec\ub7fc\ub9cc \uc120\ud0dd\uc801\uc73c\ub85c \uc870\ud68c \uac00\ub2a5\\r\\n\\r\\n#### \ucd08\uae30 MyBatis \uad6c\ud604(\ubb38\uc81c\uc810 \ud3ec\ud568)\\r\\n\\r\\n```xml\\r\\n<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"?>\\r\\n<!DOCTYPE mapper PUBLIC \\"-//mybatis.org//DTD Mapper 3.0//EN\\"\\r\\n        \\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\\">\\r\\n\\r\\n<mapper namespace=\\"com.example.mapper.UserMapper\\">\\r\\n    <select id=\\"searchClients\\" resultType=\\"ClientDto\\">\\r\\n        SELECT\\r\\n            u.user_id,\\r\\n            u.email,\\r\\n            u.name,\\r\\n            u.last_login_at,\\r\\n            c.phone_number,\\r\\n            co.company_name\\r\\n        FROM user u\\r\\n        LEFT JOIN clients c ON u.client_id = c.client_id\\r\\n        LEFT JOIN company co ON c.company_id = co.company_id\\r\\n        WHERE u.enabled = true\\r\\n\\r\\n        \x3c!-- \ub0a0\uc9dc \ud544\ud130 --\x3e\\r\\n        <if test=\\"startDate != null and endDate != null\\">\\r\\n            AND u.last_login_at BETWEEN #{startDate} AND #{endDate}\\r\\n        </if>\\r\\n\\r\\n        \x3c!-- \ud0a4\uc6cc\ub4dc \uac80\uc0c9 - \ubb38\uc81c\uc810: choose \uc911\ucca9 --\x3e\\r\\n        <if test=\\"keyword != null and keyword != \'\'\\">\\r\\n            <choose>\\r\\n                <when test=\\"range == \'all\'\\">\\r\\n                    AND (\\r\\n                        u.email LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR u.name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                    )\\r\\n                </when>\\r\\n                <when test=\\"range == \'email\'\\">\\r\\n                    AND u.email LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                </when>\\r\\n                <when test=\\"range == \'name\'\\">\\r\\n                    AND u.name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                </when>\\r\\n                <when test=\\"range == \'company\'\\">\\r\\n                    AND co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                </when>\\r\\n                <when test=\\"range == \'phone\'\\">\\r\\n                    AND c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                </when>\\r\\n            </choose>\\r\\n        </if>\\r\\n\\r\\n        ORDER BY u.created_at DESC\\r\\n        LIMIT #{offset}, #{size}\\r\\n    </select>\\r\\n\\r\\n    \x3c!-- COUNT \ucffc\ub9ac - \ubb38\uc81c\uc810: \ubd88\ud544\uc694\ud55c JOIN --\x3e\\r\\n    <select id=\\"countFilteredClients\\" resultType=\\"long\\">\\r\\n        SELECT COUNT(*)\\r\\n        FROM user u\\r\\n        LEFT JOIN clients c ON u.client_id = c.client_id\\r\\n        LEFT JOIN company co ON c.company_id = co.company_id\\r\\n        WHERE u.enabled = true\\r\\n\\r\\n        <if test=\\"startDate != null and endDate != null\\">\\r\\n            AND u.last_login_at BETWEEN #{startDate} AND #{endDate}\\r\\n        </if>\\r\\n\\r\\n        <if test=\\"keyword != null and keyword != \'\'\\">\\r\\n            <choose>\\r\\n                <when test=\\"range == \'all\'\\">\\r\\n                    AND (\\r\\n                        u.email LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR u.name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                        OR c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                    )\\r\\n                </when>\\r\\n                \x3c!-- ... \ub3d9\uc77c\ud55c choose \ubc18\ubcf5 --\x3e\\r\\n            </choose>\\r\\n        </if>\\r\\n    </select>\\r\\n</mapper>\\r\\n```\\r\\n\\r\\n#### \ucd08\uae30 MyBatis \uc131\ub2a5 \ud14c\uc2a4\ud2b8\\r\\n\\r\\n| \uc2dc\ub098\ub9ac\uc624       | \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04(ms) | \ucd5c\ub300(ms) | \ucc98\ub9ac\ub7c9(TPS) |\\r\\n| -------------- | ----------------- | -------- | ----------- |\\r\\n| Search         | 24.04             | 108      | 59.15       |\\r\\n| Date Filter    | 23.39             | 92       | 59.34       |\\r\\n| Basic          | 23.85             | **473**  | 57.59       |\\r\\n| Complex Filter | 23.46             | 112      | 59.32       |\\r\\n| **\ud3c9\uade0**       | **24.56**         | **473**  | **66.70**   |\\r\\n\\r\\n### \ubb38\uc81c \ubd84\uc11d\\r\\n\\r\\n- **choose \uc911\ucca9\uc73c\ub85c \uc778\ud55c SQL \uce90\uc2dc \ube44\ud6a8\uc728**\\r\\n- \ucd5c\ub300 \uc751\ub2f5\uc2dc\uac04 \ud3b8\ucc28 \ud07c (473ms)\\r\\n- **COUNT \ucffc\ub9ac\uc758 \ubd88\ud544\uc694\ud55c JOIN**\\r\\n\\r\\n  ```sql\\r\\n  SELECT COUNT(*) # 4) 3\ub2e8\uacc4 \uc870\uc778 \ud6c4 \uc5f0\uc0b0\\r\\n  FROM user u # 1) user \ud14c\uc774\ube14 \uc2a4\uce94\\r\\n  LEFT JOIN clients c ON u.client_id = c.client_id # 2) \uc784\uc2dc \ud14c\uc774\ube14 \uc0dd\uc131\\r\\n  LEFT JOIN company co ON c.company_id = co.company_id # 3) \uc784\uc2dc \ud14c\uc774\ube14 \uc0dd\uc131)\\r\\n  WHERE ...\\r\\n  ```\\r\\n\\r\\n---\\r\\n\\r\\n## 4. MyBatis \ucd5c\uc801\ud654\\r\\n\\r\\n### \uac1c\uc120 1: \ub3d9\uc801 SQL \ub2e8\uc21c\ud654\\r\\n\\r\\n**Before (choose \uc911\ucca9) \u2192 After (OR \uc870\uac74 \ud1b5\ud569):**\\r\\n\\r\\n```xml\\r\\n<if test=\\"keyword != null and keyword != \'\'\\">\\r\\n    AND (\\r\\n        (#{range} = \'all\' AND (\\r\\n            u.email LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n            OR u.name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n            OR co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n            OR c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n        ))\\r\\n        OR (#{range} = \'email\' AND u.email LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n        OR (#{range} = \'name\' AND u.name LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n        OR (#{range} = \'company\' AND co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n        OR (#{range} = \'phone\' AND c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n    )\\r\\n</if>\\r\\n```\\r\\n\\r\\n**\ud6a8\uacfc:**\\r\\n\\r\\n- **Before:** range \uac12\uc5d0 \ub530\ub77c 5\uac1c\uc758 \ub2e4\ub978 SQL \uc0dd\uc131\\r\\n- **After:** \ud56d\uc0c1 \ub3d9\uc77c\ud55c SQL \ud15c\ud50c\ub9bf \uc0dd\uc131 > \uc2e4\ud589 \uacc4\ud68d \uc7ac\uc0ac\uc6a9\uc131 \uc99d\uac00\\r\\n\\r\\n### \uac1c\uc120 2: COUNT \ucffc\ub9ac \ucd5c\uc801\ud654\\r\\n\\r\\n**Before (JOIN \uae30\ubc18) \u2192 After (EXISTS \uc11c\ube0c\ucffc\ub9ac \uae30\ubc18)**\\r\\n\\r\\n```xml\\r\\n<select id=\\"countFilteredClients\\" resultType=\\"long\\">\\r\\n    SELECT COUNT(*)\\r\\n    FROM user u\\r\\n    WHERE u.enabled = true\\r\\n\\r\\n    <if test=\\"startDate != null and endDate != null\\">\\r\\n        AND u.last_login_at BETWEEN #{startDate} AND #{endDate}\\r\\n    </if>\\r\\n\\r\\n    <if test=\\"keyword != null and keyword != \'\'\\">\\r\\n        AND (\\r\\n            (#{range} = \'all\' AND (\\r\\n                u.email LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                OR u.name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                OR EXISTS (\\r\\n                    SELECT 1 FROM clients c\\r\\n                    JOIN company co ON c.company_id = co.company_id\\r\\n                    WHERE c.client_id = u.client_id\\r\\n                    AND co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                )\\r\\n                OR EXISTS (\\r\\n                    SELECT 1 FROM clients c\\r\\n                    WHERE c.client_id = u.client_id\\r\\n                    AND c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n                )\\r\\n            ))\\r\\n            OR (#{range} = \'email\' AND u.email LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n            OR (#{range} = \'name\' AND u.name LIKE CONCAT(\'%\', #{keyword}, \'%\'))\\r\\n            OR (#{range} = \'company\' AND EXISTS (\\r\\n                SELECT 1 FROM clients c\\r\\n                JOIN company co ON c.company_id = co.company_id\\r\\n                WHERE c.client_id = u.client_id\\r\\n                AND co.company_name LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n            ))\\r\\n            OR (#{range} = \'phone\' AND EXISTS (\\r\\n                SELECT 1 FROM clients c\\r\\n                WHERE c.client_id = u.client_id\\r\\n                AND c.phone_number LIKE CONCAT(\'%\', #{keyword}, \'%\')\\r\\n            ))\\r\\n        )\\r\\n    </if>\\r\\n</select>\\r\\n```\\r\\n\\r\\n### EXISTS vs JOIN \uc131\ub2a5 \ube44\uad50\\r\\n\\r\\n1. **JOIN \ubc29\uc2dd:**\\r\\n\\r\\n   ```sql\\r\\n   SELECT COUNT(*)\\r\\n   FROM user u\\r\\n   LEFT JOIN clients c ON u.client_id = c.client_id\\r\\n   LEFT JOIN company co ON c.company_id = co.company_id\\r\\n   WHERE co.company_name LIKE \'%ABC%\'\\r\\n   ```\\r\\n\\r\\n   **\uc2e4\ud589 \uacfc\uc815:**\\r\\n\\r\\n   ```\\r\\n    1. user \ud14c\uc774\ube14 \uc804\uccb4 \uc2a4\uce94\\r\\n    2. clients \ud14c\uc774\ube14\uacfc \uc870\uc778 (1,000\uac74)\\r\\n    3. company \ud14c\uc774\ube14\uacfc \uc870\uc778 (1,000\uac74)\\r\\n    4. WHERE \uc870\uac74 \ud544\ud130\ub9c1\\r\\n    5. COUNT(*) \uacc4\uc0b0\\r\\n   ```\\r\\n\\r\\n2. **EXISTS \ubc29\uc2dd:**\\r\\n\\r\\n   ```sql\\r\\n   SELECT COUNT(*)\\r\\n   FROM user u\\r\\n   WHERE EXISTS (\\r\\n   SELECT 1 FROM clients c\\r\\n   JOIN company co ON c.company_id = co.company_id\\r\\n   WHERE c.client_id = u.client_id\\r\\n   AND co.company_name LIKE \'%ABC%\'\\r\\n   )\\r\\n   ```\\r\\n\\r\\n   **\uc2e4\ud589 \uacfc\uc815:**\\r\\n\\r\\n   ```\\r\\n   1. user \ud14c\uc774\ube14 \uc804\uccb4 \uc2a4\uce94\\r\\n   2. \uac01 \ud589\ub9c8\ub2e4 EXISTS \uc11c\ube0c\ucffc\ub9ac \uc2e4\ud589\\r\\n       2.1. \uc870\uac74 \ub9cc\uc871 \uc2dc \uc989\uc2dc TRUE \ubc18\ud658 (\uc870\uae30 \uc885\ub8cc)\\r\\n       2.2. \uccab \ubc88\uc9f8 \ub9e4\uce6d \ud589 \ubc1c\uacac \uc2dc \ub354 \uc774\uc0c1 \uac80\uc0c9 \uc548 \ud568\\r\\n   3. COUNT(*) \uacc4\uc0b0\\r\\n\\r\\n   \u2192 \ud544\uc694\ud55c \ub9cc\ud07c\ub9cc \uc870\uc778\\r\\n   ```\\r\\n\\r\\n**\uc131\ub2a5 \ucc28\uc774:**\\r\\n\\r\\n- JOIN \ubc29\uc2dd: 1,000\uac74 \uc870\uc778 \u2192 1,000\uac74 \ucc98\ub9ac\\r\\n- EXISTS \ubc29\uc2dd: \uc870\uae30 \uc885\ub8cc \u2192 \ud3c9\uade0 150\uac74 \ucc98\ub9ac\\r\\n\\r\\n---\\r\\n\\r\\n## 5. \ucd5c\uc885 \uc131\ub2a5 \ube44\uad50\\r\\n\\r\\n### MyBatis \ucd5c\uc801\ud654 \ud6c4 \ud14c\uc2a4\ud2b8 \uacb0\uacfc\\r\\n\\r\\n| \uc2dc\ub098\ub9ac\uc624       | \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04(ms) | \ucd5c\ub300(ms) | \ucc98\ub9ac\ub7c9(TPS) |\\r\\n| -------------- | ----------------- | -------- | ----------- |\\r\\n| Search         | 17.16             | 48       | 68.95       |\\r\\n| Date Filter    | 15.89             | 32       | 68.99       |\\r\\n| Basic          | 17.23             | 54       | 68.64       |\\r\\n| Complex Filter | 17.11             | 48       | 69.02       |\\r\\n| **\ud3c9\uade0**       | **15.51**         | **54**   | **273.34**  |\\r\\n\\r\\n### \uc804\uccb4 \ube44\uad50\\r\\n\\r\\n![image](../../docs/projects/security-ticket/img/mybatis_\uc131\ub2a5.png)\\r\\n\\r\\n### \uac1c\uc120 \ud6a8\uacfc\\r\\n\\r\\n**MyBatis \uac1c\uc120 \uc804 \ub300\ube44:**\\r\\n\\r\\n- \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04 **36.8% \uac10\uc18c** (24.56 \u2192 15.51ms)\\r\\n- \ucd5c\ub300 \uc751\ub2f5\uc2dc\uac04 **88.5% \uac10\uc18c** (473 \u2192 54ms)\\r\\n- \ucc98\ub9ac\ub7c9 **3.9\ubc30 \uc99d\uac00** (66.7 \u2192 273 TPS)\\r\\n\\r\\n**JPA Specification \ub300\ube44:**\\r\\n\\r\\n- \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04 **36.5% \uac10\uc18c** (24.45 \u2192 15.51ms)\\r\\n- \ucd5c\ub300 \uc751\ub2f5\uc2dc\uac04 **35.5% \uac10\uc18c** (83.67 \u2192 54ms)\\r\\n- Basic \uc694\uccad **2.3\ubc30 \ube60\ub984** (39.99 \u2192 17.23ms)\\r\\n- \ucc98\ub9ac\ub7c9 **23% \ud5a5\uc0c1** (221.77 \u2192 273 TPS)\\r\\n\\r\\n### \ucd5c\uc885 \uc544\ud0a4\ud14d\ucc98 \uc124\uacc4(\ud63c\ud569)\\r\\n\\r\\n**JPA\ub97c \uc0ac\uc6a9\ud560 \ub54c:**\\r\\n\\r\\n- \ub2e8\uc21c CRUD \uc791\uc5c5\\r\\n- \uc5d4\ud2f0\ud2f0 \uac04 \uad00\uacc4 \ud65c\uc6a9\uc774 \uc911\uc694\ud55c \uacbd\uc6b0\\r\\n- \ud2b8\ub79c\uc7ad\uc158 \ub0b4\uc5d0\uc11c \uc5d4\ud2f0\ud2f0 \ubcc0\uacbd \ucd94\uc801\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\\r\\n- 2~3\uac1c \uc774\ud558\uc758 \uc870\uac74 \uc870\ud569\\r\\n\\r\\n**MyBatis\ub97c \uc0ac\uc6a9\ud560 \ub54c:**\\r\\n\\r\\n- Window Function \ubc0f \ubcf5\uc7a1\ud55c \uc11c\ube0c\ucffc\ub9ac\\r\\n- \ub2e4\uc911 \ud14c\uc774\ube14 \uc870\uc778 (3\uac1c \uc774\uc0c1)\\r\\n- \uc131\ub2a5 \ucd5c\uc801\ud654\uac00 \uc911\uc694\ud55c \ub300\uc6a9\ub7c9 \uc870\ud68c\\r\\n- \ucffc\ub9ac \ud29c\ub2dd\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\\r\\n\\r\\n## 6. \uc815\ub9ac\\r\\n\\r\\n### \ud575\uc2ec \uc694\uc57d\\r\\n\\r\\n**\ucd5c\uc885 \uc804\ub7b5:**\\r\\n\\r\\n- **JPA**: \ub2e8\uc21c CRUD, \uc5d4\ud2f0\ud2f0 \uad00\uacc4 \ud65c\uc6a9\\r\\n- **MyBatis**: \ubcf5\uc7a1\ud55c \uac80\uc0c9, \ud1b5\uacc4, \uc131\ub2a5 \ucd5c\uc801\ud654\\r\\n\\r\\n**\uc131\ub2a5 \uac1c\uc120:**\\r\\n\\r\\n- \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04 **36.5% \uac10\uc18c**\\r\\n- \ucd5c\ub300 \uc751\ub2f5\uc2dc\uac04 **88.5% \uac10\uc18c**\\r\\n- \ucc98\ub9ac\ub7c9 **23% \ud5a5\uc0c1**\\r\\n\\r\\n**\ucc38\uace0 \uc790\ub8cc**\\r\\n\\r\\n- [MyBatis Documentation](https://mybatis.org/mybatis-3/)\\r\\n- [MySQL Performance Tuning - EXISTS vs JOIN](https://dev.mysql.com/doc/refman/8.0/en/subquery-optimization.html)"},{"id":"spring-boot-custom-session-authentication","metadata":{"permalink":"/blog/spring-boot-custom-session-authentication","source":"@site/blog/posts/pring-boot-custom-session-authentication.md","title":"Spring Boot\uc5d0\uc11c Session \uc778\uc99d\uc744 \ucee4\uc2a4\ud140\ud558\ub294 \uc774\uc720\uc640 \uc2e4\uc804 \uad6c\ud604","description":"\\"\uc65c Spring Security\uc758 \uae30\ubcf8 Form Login\uc744 \uc4f0\uc9c0 \uc54a\uace0 \uc9c1\uc811 \uad6c\ud604\ud560\uae4c?\\"","date":"2025-04-15T00:00:00.000Z","tags":[],"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"spring-boot-custom-session-authentication","title":"Spring Boot\uc5d0\uc11c Session \uc778\uc99d\uc744 \ucee4\uc2a4\ud140\ud558\ub294 \uc774\uc720\uc640 \uc2e4\uc804 \uad6c\ud604","date":"2025-04-15T00:00:00.000Z","categories":["Spring Boot","Security","Backend"],"tags":[]},"unlisted":false,"prevItem":{"title":"\ubcf5\uc7a1\ud55c \uac80\uc0c9 \ucffc\ub9ac, JPA vs MyBatis \uc131\ub2a5 \ube44\uad50\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5","permalink":"/blog/jpa-mybatis-hybrid-strategy"},"nextItem":{"title":"\uae30\ub85d \ube14\ub85c\uadf8","permalink":"/blog/index"}},"content":"> \\"\uc65c Spring Security\uc758 \uae30\ubcf8 Form Login\uc744 \uc4f0\uc9c0 \uc54a\uace0 \uc9c1\uc811 \uad6c\ud604\ud560\uae4c?\\"\\r\\n\\r\\n\uc774 \uae00\uc5d0\uc11c\ub294 **Admin/Customer \ud1b5\ud569 \ud658\uacbd**\uc5d0\uc11c **JSON \uae30\ubc18 \ub85c\uadf8\uc778 + \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4**\ub97c \uad6c\ud604\ud558\uba70 \uacaa\uc5c8\ub358 **\ud45c\uc900 \ubc29\uc2dd\uc73c\ub85c\ub294 \uc548 \ub418\ub294 \uc774\uc720**\uc640 **\uc5b4\ub5bb\uac8c \uc6b0\ud68c\ud588\ub294\uc9c0**\ub97c \uae30\ub85d\ud569\ub2c8\ub2e4.\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n---\\r\\n\\r\\n## 1. \uc65c \ucee4\uc2a4\ud140 \uc138\uc158 \uc778\uc99d?\\r\\n\\r\\n### \ud504\ub85c\uc81d\ud2b8 \uc694\uad6c\uc0ac\ud56d\\r\\n\\r\\n| \ud56d\ubaa9                 | \uc694\uad6c\uc0ac\ud56d                              | \ud45c\uc900 FormLogin \uac00\ub2a5 \uc5ec\ubd80 |\\r\\n| -------------------- | ------------------------------------- | ------------------------ |\\r\\n| **JSON \uae30\ubc18 \ub85c\uadf8\uc778** | `{\\"email\\": \\"...\\", \\"password\\": \\"...\\"}` | \ubcf5\uc7a1                     |\\r\\n| **\uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4** | \ub3d9\uc77c \uacc4\uc815 1\uba85\ub9cc \ub85c\uadf8\uc778 \ud5c8\uc6a9           | \uac00\ub2a5                     |\\r\\n| **\uacc4\uc815 \uc7a0\uae08 \ucc98\ub9ac**   | 5\ud68c \uc2e4\ud328 \uc2dc \uacc4\uc815 \uc7a0\uae40                 | \ucee4\uc2a4\ud140 \ud544\uc694              |\\r\\n| **\uccab \ub85c\uadf8\uc778 \uccb4\ud06c**   | \uccab \ub85c\uadf8\uc778 \uc2dc \ube44\ubc00\ubc88\ud638 \ubcc0\uacbd \uac15\uc81c       | \ucee4\uc2a4\ud140 \ud544\uc694              |\\r\\n| **\ud0c0\uc785\ubcc4 \uc751\ub2f5**      | Admin/Customer\ubcc4 \ub2e4\ub978 \uc751\ub2f5            | \ucee4\uc2a4\ud140 \ud544\uc694              |\\r\\n\\r\\n### \ud45c\uc900 FormLogin\uc758 \ud55c\uacc4\\r\\n\\r\\n**Spring Security\uc758 \uae30\ubcf8 FormLogin \ud544\ud130 \uccb4\uc778:**\\r\\n\\r\\n```text\\r\\nUsernamePasswordAuthenticationFilter\\r\\n    \u2192 AuthenticationManager\\r\\n    \u2192 UserDetailsService (\uc0ac\uc6a9\uc790 \uc870\ud68c)\\r\\n    \u2192 SuccessHandler / FailureHandler\\r\\n```\\r\\n\\r\\n**\ubb38\uc81c\uc810:**\\r\\n\\r\\n1. **\ud544\ud130 \ub2e8\uacc4\uc5d0\uc11c\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc8fc\uc785\uc774 \ubcf5\uc7a1**\\r\\n   - \ud544\ud130 \uae30\ubc18 \uc778\uc99d\uc740 \ucee4\uc2a4\ud130\ub9c8\uc774\uc9d5\uc774 \uc5b4\ub835\uace0, \ud2b9\ud788 AuthenticationFailureHandler\ub9cc\uc73c\ub85c\ub294 DB \uc0c1\ud0dc \ubcc0\uacbd(\uc7a0\uae08 \ub4f1)\uc744 \ucc98\ub9ac\ud558\uae30 \uc9c1\uad00\uc801\uc774\uc9c0 \uc54a\uc74c.\\r\\n2. **\uc2e4\ud328 \uce74\uc6b4\ud2b8\ub97c \uc5b4\ub514\uc11c \uad00\ub9ac\ud560\uae4c?**\\r\\n   - \ud544\ud130\ub294 Stateless\ud558\ubbc0\ub85c DB \uc5c5\ub370\uc774\ud2b8 \ub85c\uc9c1\uc744 \ub07c\uc6cc\ub123\uae30 \uc560\ub9e4\ud568\\r\\n3. **\uccab \ub85c\uadf8\uc778 \uccb4\ud06c\ub294 \uc778\uc99d \uc131\uacf5 \uc774\ud6c4\uc5d0 \ud310\ub2e8\ud574\uc57c \ud568**\\r\\n   - \ud544\ud130 \uccb4\uc778\uc5d0\uc11c\ub294 \uc21c\uc11c\uc0c1 \uc5b4\uc0c9\ud568\\r\\n\\r\\n### \ud574\uacb0 \ubc29\uc548: Controller + SessionAuthenticationStrategy \uc870\ud569\\r\\n\\r\\n> \ud544\ud130\ub97c \uc6b0\ud68c\ud558\uc5ec Controller\uc5d0\uc11c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \uc120\ud589 \ucc98\ub9ac\ud558\ub418,\\r\\n> \uc778\uc99d \uacb0\uacfc\ub294 Security\uc758 \ud45c\uc900 \ucef4\ud3ec\ub10c\ud2b8\ub97c \uc774\uc6a9\ud574 \uc138\uc158 \uc2dc\uc2a4\ud15c\uc5d0 \ub4f1\ub85d\\r\\n> \uc218\ub3d9\uc73c\ub85c Authentication \uac1d\uccb4\ub97c \uc0dd\uc131\ud558\uace0,\\r\\n> SecurityContextRepository\ub97c \ud1b5\ud574 \uc138\uc158\uc5d0 \uc601\uc18d\ud654\ud558\ub294 \uc77c\ub828\uc758 \uacfc\uc815\uc744 \ucf54\ub4dc\ub85c \uad6c\ud604\\r\\n\\r\\n**[\uae30\uc874] Filter Chain \ubc29\uc2dd**\\r\\n\\r\\n```\\r\\nRequest \u2192 Filter \u2192 AuthenticationManager \u2192 Response\\r\\n```\\r\\n\\r\\n**[\uac1c\uc120] Controller \ubc29\uc2dd**\\r\\n\\r\\n```text\\r\\nRequest \u2192 Controller \u2192 Service (\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1)\\r\\n\\r\\n    \u2192 \uc218\ub3d9\uc73c\ub85c AuthenticationManager \ud638\ucd9c\\r\\n    \u2192 SessionAuthenticationStrategy \ud638\ucd9c\\r\\n    \u2192 SecurityContext \uc800\uc7a5 \u2192 Response\\r\\n```\\r\\n\\r\\n> **Spring Security\uc758 \uc138\uc158 \uc815\ucc45\uc744 \uadf8\ub300\ub85c \ud65c\uc6a9\ud558\ub294 \ubc29\uc548**\\r\\n\\r\\n---\\r\\n\\r\\n## 2. \uc778\uc99d \uad6c\ud604\\r\\n\\r\\n### \uc804\uccb4 \uc778\uc99d \ud50c\ub85c\uc6b0\\r\\n\\r\\n```\\r\\n1. [Client] Request\\r\\n    \u2193\\r\\n2. [Controller] \uc694\uccad \uc218\uc2e0\\r\\n    \u2193\\r\\n3. [LoginService] \uac80\uc99d\\r\\n\\t\\t3.1 \uc0ac\uc6a9\uc790 \ud655\uc778\\r\\n\\t\\t3.2 \uacc4\uc815 \ud65c\uc131 \uc5ec\ubd80\\r\\n\\t\\t3.3 \ube44\ubc00\ubc88\ud638 \uac80\uc99d\\r\\n\\t\\t3.4 \uccab \ub85c\uadf8\uc778 \uac80\uc99d\\r\\n    \u2193\\r\\n4. [performSecurityAuthentication]\\r\\n\\t\\t4.1 AuthenticationManager.authenticate() \ud638\ucd9c\\r\\n\\t\\t4.2 SessionAuthenticationStrategy.onAuthentication() \ud638\ucd9c\\r\\n\\t\\t\\t\\t4.2.1) \uc911\ubcf5 \uc138\uc158 \uc81c\uc5b4 | \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0 |\\r\\n\\t\\t\\t\\t4.2.2) SessionRegistry \ub4f1\ub85d\\r\\n\\t\\t4.3 SecurityContext \uc0dd\uc131 \ubc0f \uc124\uc815\\r\\n\\t\\t4.4 HttpSession\uc5d0 SecurityContext \uc800\uc7a5\\r\\n    \u2193\\r\\n5. [Response]\\r\\n```\\r\\n\\r\\n### \ub2e8\uacc4\ubcc4 \uc124\uba85\\r\\n\\r\\n**1\ub2e8\uacc4: \uc0ac\uc6a9\uc790 \uc694\uccad \uc218\uc2e0**\\r\\n\\r\\n```java\\r\\n@PostMapping(\\"/login\\")\\r\\npublic ResponseEntity login(@RequestBody LoginDto req) {\\r\\n    // Controller\uc5d0\uc11c \uc9c1\uc811 \ucc98\ub9ac\\r\\n}\\r\\n```\\r\\n\\r\\n**2\ub2e8\uacc4: \ube44\uc988\ub2c8\uc2a4 \uac80\uc99d (LoginService)**\\r\\n\\r\\n```java\\r\\nif (user.isLocked()) {\\r\\n    throw new AccountLockedException(\\"\uacc4\uc815\uc774 \uc7a0\uacbc\uc2b5\ub2c8\ub2e4.\\");\\r\\n}\\r\\n\\r\\nif (user.isFirstLogin()) {\\r\\n    return new FirstLoginResponse(\\"\ube44\ubc00\ubc88\ud638\ub97c \ubcc0\uacbd\ud558\uc138\uc694.\\");\\r\\n}\\r\\n\\r\\nif (!passwordEncoder.matches(req.getPassword(), user.getPassword())) {\\r\\n    user.incrementFailCount();\\r\\n    if (user.getFailCount() >= 5) {\\r\\n        user.lock();\\r\\n    }\\r\\n    userRepository.save(user);\\r\\n    throw new BadCredentialsException(\\"\uc544\uc774\ub514 \ub610\ub294 \ube44\ubc00\ubc88\ud638 \ud2c0\ub838\uc2b5\ub2c8\ub2e4.\\");\\r\\n}\\r\\n```\\r\\n\\r\\n**3\ub2e8\uacc4: Spring Security \uc778\uc99d \uc2e4\ud589**\\r\\n\\r\\n```java\\r\\n// AuthenticationManager\ub97c \uc218\ub3d9\uc73c\ub85c \ud638\ucd9c\\r\\nUsernamePasswordAuthenticationToken authToken =\\r\\n    new UsernamePasswordAuthenticationToken(\\r\\n        req.getEmail(),\\r\\n        req.getPassword(),\\r\\n        user.getAuthorities()\\r\\n    );\\r\\nAuthentication authentication = authenticationManager.authenticate(authToken);\\r\\n```\\r\\n\\r\\n**4\ub2e8\uacc4: \uc138\uc158 \uc815\ucc45 \uc801\uc6a9**\\r\\n\\r\\n```java\\r\\n// SessionAuthenticationStrategy \uc218\ub3d9 \ud638\ucd9c\\r\\nsessionAuthenticationStrategy.onAuthentication(authentication, request, response);\\r\\n```\\r\\n\\r\\n**5\ub2e8\uacc4: SecurityContext \uc800\uc7a5**\\r\\n\\r\\n```java\\r\\nSecurityContext context = securityContextHolderStrategy.createEmptyContext();\\r\\ncontext.setAuthentication(authentication);\\r\\nSecurityContextHolder.setContext(context);\\r\\nsecurityContextRepository.saveContext(context, request, response);\\r\\n```\\r\\n\\r\\n---\\r\\n\\r\\n## 3. \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8 \uad6c\ud604\\r\\n\\r\\n### **\uac01 \ucef4\ud3ec\ub10c\ud2b8\uc758 \uc5ed\ud560**\\r\\n\\r\\n| \ucef4\ud3ec\ub10c\ud2b8                        | \uc5ed\ud560                                           | \uc2e4\ubb34 \uc758\ubbf8                                           |\\r\\n| ------------------------------- | ---------------------------------------------- | --------------------------------------------------- |\\r\\n| `HttpSessionEventPublisher`     | \uc138\uc158 \uc0dd\uc131/\uc0ad\uc81c \uc774\ubca4\ud2b8\ub97c Spring Security\uc5d0 \uc804\ub2ec | \ub85c\uadf8\uc544\uc6c3/\ud0c0\uc784\uc544\uc6c3 \uc2dc SessionRegistry \uc790\ub3d9 \uc815\ub9ac      |\\r\\n| `SessionRegistry`               | \uc138\uc158 \ubc0f \uc0ac\uc6a9\uc790 \uc0c1\ud0dc \uad00\ub9ac                       | Admin UI\uc5d0\uc11c \\"\ud604\uc7ac \uc811\uc18d \uc911\uc778 \uc0ac\uc6a9\uc790\\" \ubaa9\ub85d \ud655\uc778 \uac00\ub2a5 |\\r\\n| `SessionAuthenticationStrategy` | \uc138\uc158 \uc815\ucc45 \uccb4\uc778                                 | \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4 + \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0 + \uc138\uc158 \ub4f1\ub85d  |\\r\\n\\r\\n### 1) User Entity\\r\\n\\r\\n```java\\r\\n@Entity\\r\\n@Table(name = \\"users\\")\\r\\n@EqualsAndHashCode(of = \\"email\\", callSuper = false)\\r\\n@NoArgsConstructor(access = AccessLevel.PROTECTED)\\r\\npublic class User implements UserDetails {\\r\\n    //...\\r\\n}\\r\\n```\\r\\n\\r\\n#### `equals`/`hashCode`\ub97c \uc624\ubc84\ub77c\uc774\ub529 \ud558\ub294 \uc774\uc720\\r\\n\\r\\n- Spring Security\uc758 `SessionRegistry`\ub294 **\ub3d9\uc77c \uc0ac\uc6a9\uc790\uc758 \uc138\uc158\uc744 \ucd94\uc801**\ud558\uae30 \uc704\ud574\\r\\n- \ub0b4\ubd80\uc801\uc73c\ub85c `Map<Object, Set<SessionInformation>>`\uc744 \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 `equals`/`hashCode`\ub97c \uc624\ubc84\ub77c\uc774\ub529\ud574 \ud574\uc57c \ud568\\r\\n\\r\\n  ```java\\r\\n  // SessionRegistryImpl \ub0b4\ubd80\\r\\n  private final ConcurrentMap> principals = new ConcurrentHashMap<>();\\r\\n\\r\\n  public void registerNewSession(String sessionId, Object principal) {\\r\\n  Set sessions = principals.get(principal);\\r\\n  // \uc5ec\uae30\uc11c principal.equals()\ub85c \ub3d9\uc77c \uc0ac\uc6a9\uc790 \ud310\ub2e8\\r\\n  }\\r\\n  ```\\r\\n\\r\\n- `equals`\ub97c \uc624\ubc84\ub77c\uc774\ub529\ud558\uc9c0 \uc54a\uc73c\uba74: **\uac1d\uccb4 \ucc38\uc870 \ube44\uad50**\ub85c \ub3d9\uc791\\r\\n- SessionRegistry\uc5d0 \uac19\uc740 \uc0ac\uc6a9\uc790\uac00 \uc5ec\ub7ec \ubc88 \ub4f1\ub85d\ub418\uc5b4, \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4 X\\r\\n\\r\\n---\\r\\n\\r\\n### 2) LoginService\\r\\n\\r\\n#### 1) \ub85c\uadf8\uc778 \uba54\uc778 \ub85c\uc9c1\\r\\n\\r\\n```java\\r\\n    @Transactional\\r\\n    public LoginResponse login(LoginDto req, HttpServletRequest request,\\r\\n                                HttpServletResponse response) {\\r\\n\\r\\n        // 1. \uc0ac\uc6a9\uc790 \uc870\ud68c\\r\\n        User user = userRepository.findByEmail(req.getEmail())\\r\\n            .orElseThrow(() -> new UsernameNotFoundException(\\"\uc0ac\uc6a9\uc790\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\\"));\\r\\n\\r\\n        // 2. \uacc4\uc815 \uc7a0\uae40 \uccb4\ud06c\\r\\n        if (user.isLocked()) {\\r\\n            throw new AccountLockedException(\\"\uacc4\uc815\uc774 \uc7a0\uacbc\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694.\\");\\r\\n        }\\r\\n\\r\\n        // 3. \uacc4\uc815 \ud65c\uc131\ud654 \uccb4\ud06c\\r\\n        if (!user.isEnabled()) {\\r\\n            throw new DisabledException(\\"\ube44\ud65c\uc131\ud654\ub41c \uacc4\uc815\uc785\ub2c8\ub2e4.\\");\\r\\n        }\\r\\n\\r\\n        // 4. \ube44\ubc00\ubc88\ud638 \uac80\uc99d\\r\\n        if (!passwordEncoder.matches(req.getPassword(), user.getPassword())) {\\r\\n            user.incrementFailCount();\\r\\n            userRepository.save(user);\\r\\n\\r\\n            if (user.isLocked()) {\\r\\n                throw new AccountLockedException(\\r\\n                    \\"5\ud68c \uc2e4\ud328\ub85c \uacc4\uc815\uc774 \uc7a0\uacbc\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694.\\"\\r\\n                );\\r\\n            }\\r\\n\\r\\n            throw new BadCredentialsException(\\r\\n                String.format(\\"\uc544\uc774\ub514 \ub610\ub294 \ube44\ubc00\ubc88\ud638\uac00 \ud2c0\ub838\uc2b5\ub2c8\ub2e4. (\ub0a8\uc740 \uc2dc\ub3c4: %d\ud68c)\\",\\r\\n                              5 - user.getFailCount())\\r\\n            );\\r\\n        }\\r\\n\\r\\n        // 5. \uccab \ub85c\uadf8\uc778 \uccb4\ud06c\\r\\n        if (user.isFirstLogin()) {\\r\\n            return LoginResponse.firstLogin(\\"\ube44\ubc00\ubc88\ud638\ub97c \ubcc0\uacbd\ud574\uc57c \ud569\ub2c8\ub2e4.\\");\\r\\n        }\\r\\n\\r\\n        // 6. Spring Security \uc778\uc99d \uc2e4\ud589\\r\\n        performSecurityAuthentication(req, user, request, response);\\r\\n\\r\\n        // 7. \ub85c\uadf8\uc778 \uc131\uacf5 \ucc98\ub9ac\\r\\n        user.resetFailCount();\\r\\n        userRepository.save(user);\\r\\n\\r\\n        return LoginResponse.success(user);\\r\\n    }\\r\\n```\\r\\n\\r\\n#### 2) Spring Security \uc778\uc99d \uc218\ud589\\r\\n\\r\\n```java\\r\\n    private void performSecurityAuthentication(LoginDto req, User user,\\r\\n                                                HttpServletRequest request,\\r\\n                                                HttpServletResponse response) {\\r\\n\\r\\n        // 1. AuthenticationManager\ub97c \ud1b5\ud55c \uc778\uc99d\\r\\n        UsernamePasswordAuthenticationToken authToken =\\r\\n            new UsernamePasswordAuthenticationToken(\\r\\n                req.getEmail(),\\r\\n                req.getPassword(),\\r\\n                user.getAuthorities()\\r\\n            );\\r\\n\\r\\n        Authentication authentication = authenticationManager.authenticate(authToken);\\r\\n\\r\\n        // 2. SessionAuthenticationStrategy \ud638\ucd9c (\uc138\uc158 \uc815\ucc45 \uc801\uc6a9) \u2192 SessionRegistry \ub4f1\ub85d\\r\\n        sessionAuthenticationStrategy.onAuthentication(authentication, request, response);\\r\\n\\r\\n        // 3. SecurityContext \uc0dd\uc131 \ubc0f \uc124\uc815\\r\\n        SecurityContext context = securityContextHolderStrategy.createEmptyContext();\\r\\n        context.setAuthentication(authentication);\\r\\n        SecurityContextHolder.setContext(context);\\r\\n\\r\\n        // 4. SecurityContextRepository\uc5d0 \uc800\uc7a5 (HttpSession\uc5d0 \uc800\uc7a5\ub428)\\r\\n        securityContextRepository.saveContext(context, request, response);\\r\\n    }\\r\\n```\\r\\n\\r\\n---\\r\\n\\r\\n### 3) SessionConfig - \uc138\uc158 \uc815\ucc45 \uc124\uc815\\r\\n\\r\\n**1) HttpSessionEventPublisher**\\r\\n\\r\\n> \uc138\uc158 \uc0dd\uc131/\uc0ad\uc81c \uc774\ubca4\ud2b8\ub97c Spring Security\uc5d0 \uc804\ub2ec\\r\\n\\r\\n```java\\r\\n    public HttpSessionEventPublisher httpSessionEventPublisher() {\\r\\n        return new HttpSessionEventPublisher() {\\r\\n            @Override\\r\\n            public void sessionCreated(HttpSessionEvent event) {\\r\\n                super.sessionCreated(event);\\r\\n            }\\r\\n\\r\\n            @Override\\r\\n            public void sessionDestroyed(HttpSessionEvent event) {\\r\\n                super.sessionDestroyed(event);\\r\\n            }\\r\\n        };\\r\\n    }\\r\\n```\\r\\n\\r\\n**2) \uc11c\ube14\ub9bf \ub9ac\uc2a4\ub108\uc5d0 \ub4f1\ub85d (\uc815\uc0c1 \ub3d9\uc791 \ubcf4\uc7a5)**\\r\\n\\r\\n> **(1)HttpSessionEventPublisher**\uc744 ServletListener\uc5d0 \ub4f1\ub85d\ud574\uc57c \ub85c\uadf8\uc544\uc6c3 \uc2dc SessionRegistry\uc5d0\uc11c \uc138\uc158\uc774 \uc81c\uac70\ub428\\r\\n> \ud558\uc9c0 \uc54a\uc744 \uacbd\uc6b0, \uc138\uc158\uc774 \ub204\uc801\\r\\n\\r\\n```java\\r\\n    public ServletListenerRegistrationBean\\r\\n            httpSessionEventPublisherRegistration() {\\r\\n        return new ServletListenerRegistrationBean<>(httpSessionEventPublisher());\\r\\n    }\\r\\n```\\r\\n\\r\\n**3) SessionRegistry**\\r\\n\\r\\n> \uc138\uc158 \ubc0f \uc0ac\uc6a9\uc790 \uc0c1\ud0dc \uad00\ub9ac \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8\\r\\n\\r\\n```java\\r\\n    public SessionRegistry sessionRegistry() {\\r\\n        return new SessionRegistryImpl() {\\r\\n            @Override\\r\\n            public void registerNewSession(String sessionId, Object principal) {\\r\\n                super.registerNewSession(sessionId, principal);\\r\\n            }\\r\\n\\r\\n            @Override\\r\\n            public void removeSessionInformation(String sessionId) {\\r\\n                SessionInformation info = getSessionInformation(sessionId);\\r\\n                super.removeSessionInformation(sessionId);\\r\\n            }\\r\\n\\r\\n            private String extractPrincipalName(Object principal) {\\r\\n                if (principal instanceof User) {\\r\\n                    return ((User) principal).getEmail();\\r\\n                }\\r\\n                return principal.toString();\\r\\n            }\\r\\n        };\\r\\n    }\\r\\n```\\r\\n\\r\\n**4) SessionAuthenticationStrategy**\\r\\n\\r\\n> \uc778\uc99d \uc131\uacf5 \uc2dc \uc791\ub3d9\ud558\ub294 \uc138\uc158 \uc815\ucc45\\r\\n\\r\\n```java\\r\\n    public SessionAuthenticationStrategy sessionAuthenticationStrategy(\\r\\n            SessionRegistry sessionRegistry) {\\r\\n\\r\\n        // 3-1) \ub3d9\uc2dc \ub85c\uadf8\uc778 \uac1c\uc218 \uc81c\ud55c\\r\\n        ConcurrentSessionControlAuthenticationStrategy concurrentControl =\\r\\n            new ConcurrentSessionControlAuthenticationStrategy(sessionRegistry);\\r\\n        concurrentControl.setMaximumSessions(1);  // \ub3d9\uc77c \uacc4\uc815 1\uba85\ub9cc\\r\\n        concurrentControl.setExceptionIfMaximumExceeded(false);  // \uae30\uc874 \uc138\uc158 \ub9cc\ub8cc\\r\\n\\r\\n        // 3-2) \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0 (\uc138\uc158 ID \uc7ac\ubc1c\uae09)\\r\\n        SessionFixationProtectionStrategy sessionFixation =\\r\\n            new SessionFixationProtectionStrategy();\\r\\n        sessionFixation.setMigrateSessionAttributes(true);\\r\\n\\r\\n        // 3-3) SessionRegistry\uc5d0 \uc138\uc158 \ub4f1\ub85d\\r\\n        RegisterSessionAuthenticationStrategy registerSession =\\r\\n            new RegisterSessionAuthenticationStrategy(sessionRegistry);\\r\\n\\r\\n        // 3\uac00\uc9c0 \uc804\ub7b5\uc744 Composite\ub85c \ud1b5\ud569\\r\\n        return new CompositeSessionAuthenticationStrategy(Arrays.asList(\\r\\n            concurrentControl,\\r\\n            sessionFixation,\\r\\n            registerSession\\r\\n        ));\\r\\n    }\\r\\n```\\r\\n\\r\\n---\\r\\n\\r\\n### 4) SecurityFilterChain \uc124\uc815\\r\\n\\r\\n> \ucee8\ud2b8\ub864\ub7ec\ub294 \\"\ub85c\uadf8\uc778 \uc2dc \ub531 \ud55c \ubc88 \uc2e4\ud589\\"\ub418\uc5b4 \\"\uc138\uc158 \uc0dd\uc131 \ubc0f \uc804\ub7b5 \uc218\ub3d9 \ud638\ucd9c\\"\ud568\\r\\n> \ud544\ud130\ub294 \\"\ub85c\uadf8\uc778 \uc774\ud6c4 API\\"\uc5d0 \\"\uc138\uc158 \uc720\ud6a8\uc131 \uac80\uc99d \ubc0f \uc815\ucc45 \ub2f4\ub2f9\\"\\r\\n\\r\\n```java\\r\\n@Bean\\r\\npublic SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\\r\\n    http\\r\\n        .cors(cors -> cors.configurationSource(corsConfigurationSource()))\\r\\n        .csrf(csrf -> csrf.disable())  // REST API\ub294 CSRF \ubd88\ud544\uc694\\r\\n\\r\\n        // SecurityContext \uc800\uc7a5 \ubc29\uc2dd \uc124\uc815\\r\\n        .securityContext(context -> context\\r\\n            .securityContextRepository(securityContextRepository())\\r\\n            .requireExplicitSave(true)  // \uba85\uc2dc\uc801 \uc800\uc7a5 (Controller\uc5d0\uc11c \uc218\ub3d9 \uc800\uc7a5)\\r\\n        )\\r\\n\\r\\n        // \uc138\uc158 \uad00\ub9ac \uc124\uc815\\r\\n        .sessionManagement(session -> session\\r\\n            .sessionFixation().changeSessionId()  // \uc138\uc158 \uace0\uc815 \uacf5\uaca9 \ubc29\uc9c0\\r\\n            .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)\\r\\n            .maximumSessions(1)  // \ub3d9\uc77c \uacc4\uc815 1\uba85\ub9cc\\r\\n            .maxSessionsPreventsLogin(false)  // \uae30\uc874 \uc138\uc158 \ub9cc\ub8cc \ubc29\uc2dd\\r\\n            .sessionRegistry(sessionRegistry())\\r\\n            .expiredSessionStrategy(customSessionExpiredStrategy())  // \ub9cc\ub8cc \uc2dc \ucc98\ub9ac\\r\\n        )\\r\\n\\r\\n        // \uc608\uc678 \ucc98\ub9ac\\r\\n        .exceptionHandling(ex -> ex\\r\\n            .authenticationEntryPoint(authenticationDeniedHandler())  // 401\\r\\n            .accessDeniedHandler(authorizationDeniedHandler())  // 403\\r\\n        )\\r\\n\\r\\n        // \ucee4\uc2a4\ud140 \ud544\ud130 \ucd94\uac00\\r\\n        .addFilterBefore(sessionExpiredFilter(), SecurityContextPersistenceFilter.class)\\r\\n        .addFilterBefore(improvedLogoutFilter(), LogoutFilter.class);\\r\\n\\r\\n    return http.build();\\r\\n}\\r\\n```\\r\\n\\r\\n**\uc8fc\uc694 \uc124\uc815 \uc124\uba85**\\r\\n\\r\\n- **requireExplicitSave**\\r\\n  - \uae30\ubcf8\uac12(false)\uc740 SecurityContextPersistenceFilter\uac00 \uc790\ub3d9 \uc800\uc7a5\\r\\n  - true\ub85c \uc124\uc815 \uc2dc Controller\uc5d0\uc11c \uc218\ub3d9\uc73c\ub85c saveContext() \ud638\ucd9c \ud544\uc694\\r\\n  - true\ub85c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uc73c\uba74, SecurityContext\uac00 \ub450 \ubc88 \uc800\uc7a5\ub428\\r\\n\\r\\n- **sessionFixation().changeSessionId()**\\r\\n  - \uc138\uc158 \uace0\uc815 \uacf5\uaca9(Session Fixation) \ubc29\uc9c0\\r\\n  - \ub85c\uadf8\uc778 \uc131\uacf5 \uc2dc \uc138\uc158 ID\ub97c \uc0c8\ub85c \ubc1c\uae09\ud558\uc5ec \uacf5\uaca9\uc790\uac00 \ud0c8\ucde8\ud55c \uc138\uc158 ID \ubb34\ud6a8\ud654\\r\\n\\r\\n---\\r\\n\\r\\n## 4. \ub3d9\uc791 \uac80\uc99d\\r\\n\\r\\n**1) \uc815\uc0c1 \ub85c\uadf8\uc778**\\r\\n\\r\\n```bash\\r\\nPOST /api/login\\r\\n{\\r\\n  \\"email\\": \\"user@example.com\\",\\r\\n  \\"password\\": \\"password123\\"\\r\\n}\\r\\n\\r\\n\u2192 200 OK\\r\\n{\\r\\n  \\"status\\": \\"SUCCESS\\",\\r\\n  \\"user\\": {\\r\\n    \\"email\\": \\"user@example.com\\",\\r\\n    \\"type\\": \\"CUSTOMER\\"\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n**2) 5\ud68c \uc2e4\ud328 \u2192 \uacc4\uc815 \uc7a0\uae40**\\r\\n\\r\\n```bash\\r\\n# 1~4\ud68c \uc2e4\ud328\\r\\n\u2192 400 Bad Request\\r\\n{\\r\\n  \\"error\\": \\"\uc544\uc774\ub514 \ub610\ub294 \ube44\ubc00\ubc88\ud638\uac00 \ud2c0\ub838\uc2b5\ub2c8\ub2e4. (\ub0a8\uc740 \uc2dc\ub3c4: 4\ud68c)\\"\\r\\n}\\r\\n\\r\\n# 5\ud68c \uc2e4\ud328\\r\\n\u2192 423 Locked\\r\\n{\\r\\n  \\"error\\": \\"5\ud68c \uc2e4\ud328\ub85c \uacc4\uc815\uc774 \uc7a0\uacbc\uc2b5\ub2c8\ub2e4.\\"\\r\\n}\\r\\n```\\r\\n\\r\\n**3) \uccab \ub85c\uadf8\uc778**\\r\\n\\r\\n```bash\\r\\nPOST /api/login\\r\\n{\\r\\n  \\"email\\": \\"newuser@example.com\\",\\r\\n  \\"password\\": \\"temp123\\"\\r\\n}\\r\\n\\r\\n\u2192 200 OK\\r\\n{\\r\\n  \\"status\\": \\"FIRST_LOGIN\\",\\r\\n  \\"message\\": \\"\ube44\ubc00\ubc88\ud638\ub97c \ubcc0\uacbd\ud574\uc57c \ud569\ub2c8\ub2e4.\\"\\r\\n}\\r\\n```\\r\\n\\r\\n**4) \uc911\ubcf5 \ub85c\uadf8\uc778 \uc81c\uc5b4**\\r\\n\\r\\n```bash\\r\\n# \uc0ac\uc6a9\uc790 A: \ub85c\uadf8\uc778 \uc131\uacf5 (Session ID: abc123)\\r\\n# \uc0ac\uc6a9\uc790 B: \uac19\uc740 \uacc4\uc815\uc73c\ub85c \ub85c\uadf8\uc778 \uc2dc\ub3c4\\r\\n\\r\\n\u2192 \uc0ac\uc6a9\uc790 A\uc758 \uc138\uc158\uc774 \ub9cc\ub8cc\ub428\\r\\n\u2192 \uc0ac\uc6a9\uc790 A\uac00 API \ud638\ucd9c \uc2dc 401 Unauthorized \uc751\ub2f5\\r\\n```\\r\\n\\r\\n---\\r\\n\\r\\n## 5. \uc815\ub9ac\\r\\n\\r\\n### \ud575\uc2ec \uc694\uc57d\\r\\n\\r\\n> JSON \uae30\ubc18 \ub85c\uadf8\uc778 + \uacc4\uc815 \uc7a0\uae08 + \uccab \ub85c\uadf8\uc778 \uccb4\ud06c + ROLE\ubcc4 \uc751\ub2f5  \\r\\n> \uc774 4\uac00\uc9c0\ub97c FormLogin \ud544\ud130\uc5d0\uc11c \ucc98\ub9ac\ud558\uae30\ub294 \ub108\ubb34 \ubcf5\uc7a1\ud574\uc2b5\ub2c8\ub2e4.\\r\\n\\r\\n**Controller \ubc29\uc2dd\uc73c\ub85c \uc804\ud658\ud55c \ud6c4:**\\r\\n\\r\\n- \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc774 Service \ub808\uc774\uc5b4\uc5d0 \uba85\ud655\ud788 \ubd84\ub9ac\ub428\\r\\n- Spring Security\uc758 \uc138\uc158 \uc815\ucc45\uc740 \uadf8\ub300\ub85c \ud65c\uc6a9\\r\\n\\r\\n### \ud2b8\ub808\uc774\ub4dc\uc624\ud504\\r\\n\\r\\n- **\uc7a5\uc810:**\\r\\n  - \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc790\uc720\ub3c4 \ub192\uc74c\\r\\n  - \ucf54\ub4dc \uac00\ub3c5\uc131 \uc88b\uc74c\\r\\n\\r\\n- **\ub2e8\uc810:**\\r\\n  - Spring Security\uc758 \\"\uc790\ub3d9\ud654\\"\ub97c \ud3ec\uae30\\r\\n  - `SessionAuthenticationStrategy` \uc218\ub3d9 \ud638\ucd9c \ud544\uc694\\r\\n  - `SecurityContext` \uc218\ub3d9 \uc800\uc7a5 \ud544\uc694"},{"id":"/index","metadata":{"permalink":"/blog/index","source":"@site/blog/index.md","title":"\uae30\ub85d \ube14\ub85c\uadf8","description":"\uad81\uae08\ud55c\uac70 \uc815\ub9ac\ud574\ub193\uc740 \uacf3","date":"2000-07-13T00:00:00.000Z","tags":[],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\uae30\ub85d \ube14\ub85c\uadf8","description":"\uad81\uae08\ud55c\uac70 \uc815\ub9ac\ud574\ub193\uc740 \uacf3","date":"2000-07-13T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Spring Boot\uc5d0\uc11c Session \uc778\uc99d\uc744 \ucee4\uc2a4\ud140\ud558\ub294 \uc774\uc720\uc640 \uc2e4\uc804 \uad6c\ud604","permalink":"/blog/spring-boot-custom-session-authentication"}},"content":"\uc548\ub155\ud558\uc138\uc694!  \\r\\n**\uc2e0\uc785 \uac1c\ubc1c\uc790 \uc2e0\uac15\ud76c**\uc785\ub2c8\ub2e4 \ud83d\ude0a\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n> \u2728 _\u201c\uae30\ub85d\uc740 \uac00\uc7a5 \uac15\ub825\ud55c \uc131\uc7a5 \ub3c4\uad6c\ub2e4\u201d_\\r\\n\\r\\n## \ud83d\udcda \uac8c\uc2dc\uae00 \ubaa9\ub85d\\r\\n\\r\\n### \ud83d\udd34 Redis & \ub3d9\uc2dc\uc131\\r\\n\\r\\n- [\ub808\ub514\uc2a4\ub294 \uc2f1\uae00\uc2a4\ub808\ub4dc\uc778\ub370 \uc65c \ub3d9\uc2dc\uc131 \uc81c\uc5b4\uac00 \ud544\uc694\ud560\uae4c?](./posts/redis-concurrency.md)\\r\\n- [\uc774\uba54\uc77c \uc778\uc99d\uc5d0\uc11c Redis\uac00 \uac15\uc810\uc744 \uac16\ub294 \uc774\uc720: TTL\uacfc \uc6d0\uc790 \uc5f0\uc0b0](./posts/redis-email-verification.md)\\r\\n\\r\\n### \ud83d\udfe2 Spring & Backend\\r\\n\\r\\n- [Spring Boot\uc5d0\uc11c Session \uc778\uc99d\uc744 \ucee4\uc2a4\ud140\ud558\ub294 \uc774\uc720\uc640 \uc2e4\uc804 \uad6c\ud604](./posts/pring-boot-custom-session-authentication.md)\\r\\n- [\ubcf5\uc7a1\ud55c \uac80\uc0c9 \ucffc\ub9ac, JPA vs MyBatis \uc131\ub2a5 \ube44\uad50\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5](./posts/jpa-mybatis-hybrid-strategy.md)\\r\\n- [\uc774\uba54\uc77c \ubc1c\uc1a1 API \uc751\ub2f5 \uc18d\ub3c4 \uac1c\uc120: Spring Event\uc640 \ube44\ub3d9\uae30 \ucc98\ub9ac](./posts/spring-event-async-email-optimization.md)\\r\\n\\r\\n### \ud83d\udfe3 Docker / Infra\\r\\n\\r\\n- _(\uc0c8\ub85c\uc6b4 \uae00\uc744 \uc900\ube44 \uc911\uc774\uc5d0\uc694 \ud83d\ude80)_\\r\\n\\r\\n---\\r\\n\\r\\n## \ud83d\udccc About Me\\r\\n\\r\\n- \ud83c\udf93 \ucef4\ud4e8\ud130\uc815\ubcf4\uacf5\ud559 \uc804\uacf5\\r\\n- \ud83d\udcbb \ubc31\uc5d4\ub4dc \uac1c\ubc1c\uc790 \uc9c0\ub9dd\\r\\n- \ud83d\udcc8 \uafb8\uc900\ud788 \uc131\uc7a5 \uc911\\r\\n\\r\\n---"}]}}')}}]);