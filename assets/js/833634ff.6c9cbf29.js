"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[1974],{1727(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"projects/readyberry/troubleshooting/toss-sdk-optimization","title":"Toss SDK useEffect \ucd5c\uc801\ud654 (70% \uac1c\uc120)","description":"useEffect \uc758\uc874\uc131 \ucd5c\uc801\ud654 + useRef\ub85c \uacb0\uc81c \ud398\uc774\uc9c0 \ub85c\ub529 70% \ub2e8\ucd95","source":"@site/docs/projects/readyberry/troubleshooting/toss-sdk-optimization.md","sourceDirName":"projects/readyberry/troubleshooting","slug":"/projects/readyberry/troubleshooting/toss-sdk-optimization","permalink":"/docs/projects/readyberry/troubleshooting/toss-sdk-optimization","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Toss SDK useEffect \ucd5c\uc801\ud654 (70% \uac1c\uc120)"},"sidebar":"tutorialSidebar","previous":{"title":"ReadyBerry","permalink":"/docs/projects/readyberry/"}}');var t=r(4848),i=r(8453);const d={sidebar_position:1,title:"Toss SDK useEffect \ucd5c\uc801\ud654 (70% \uac1c\uc120)"},c="Toss Payments SDK useEffect \uc911\ubcf5 \uc2e4\ud589 \ubb38\uc81c \ud574\uacb0",l={},o=[{value:"0. \uac1c\uc694",id:"0-\uac1c\uc694",level:2},{value:"1. \ubb38\uc81c \uc9c4\ub2e8",id:"1-\ubb38\uc81c-\uc9c4\ub2e8",level:2},{value:"AS-IS: \ubb38\uc81c\uac00 \ub418\uc5c8\ub358 \ucf54\ub4dc \uad6c\uc870",id:"as-is-\ubb38\uc81c\uac00-\ub418\uc5c8\ub358-\ucf54\ub4dc-\uad6c\uc870",level:3},{value:"2. \ud574\uacb0 \uacfc\uc815",id:"2-\ud574\uacb0-\uacfc\uc815",level:2},{value:"Step 1: useEffect \uc758\uc874\uc131 \ubc30\uc5f4 \ucd5c\uc801\ud654",id:"step-1-useeffect-\uc758\uc874\uc131-\ubc30\uc5f4-\ucd5c\uc801\ud654",level:3},{value:"Step 2: \uae08\uc561 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc810 \ubcc0\uacbd",id:"step-2-\uae08\uc561-\uc5c5\ub370\uc774\ud2b8-\uc2dc\uc810-\ubcc0\uacbd",level:3},{value:"3. \uac1c\uc120 \ud6a8\uacfc",id:"3-\uac1c\uc120-\ud6a8\uacfc",level:2},{value:"\uc131\ub2a5 \ube44\uad50",id:"\uc131\ub2a5-\ube44\uad50",level:3},{value:"\uc2dc\ub098\ub9ac\uc624\ubcc4 useEffect \uc2e4\ud589 \ud69f\uc218",id:"\uc2dc\ub098\ub9ac\uc624\ubcc4-useeffect-\uc2e4\ud589-\ud69f\uc218",level:3},{value:"4. \ud575\uc2ec \ud3ec\uc778\ud2b8",id:"4-\ud575\uc2ec-\ud3ec\uc778\ud2b8",level:2},{value:"1\ufe0f\u20e3 useEffect \uc758\uc874\uc131 \uad00\ub9ac",id:"1\ufe0f\u20e3-useeffect-\uc758\uc874\uc131-\uad00\ub9ac",level:3},{value:"2\ufe0f\u20e3 useRef\uc758 \uc62c\ubc14\ub978 \ud65c\uc6a9",id:"2\ufe0f\u20e3-useref\uc758-\uc62c\ubc14\ub978-\ud65c\uc6a9",level:3},{value:"3\ufe0f\u20e3 \ube44\ub3d9\uae30 \uc791\uc5c5 \uc21c\uc11c \uad00\ub9ac",id:"3\ufe0f\u20e3-\ube44\ub3d9\uae30-\uc791\uc5c5-\uc21c\uc11c-\uad00\ub9ac",level:3},{value:"5. \ucd94\uac00 \uac1c\uc120\uc0ac\ud56d",id:"5-\ucd94\uac00-\uac1c\uc120\uc0ac\ud56d",level:2},{value:"\uc5d0\ub7ec \ucc98\ub9ac \uac15\ud654",id:"\uc5d0\ub7ec-\ucc98\ub9ac-\uac15\ud654",level:3},{value:"6. \uacb0\ub860",id:"6-\uacb0\ub860",level:2},{value:"7. \ucc38\uace0 \uc790\ub8cc",id:"7-\ucc38\uace0-\uc790\ub8cc",level:2}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"toss-payments-sdk-useeffect-\uc911\ubcf5-\uc2e4\ud589-\ubb38\uc81c-\ud574\uacb0",children:"Toss Payments SDK useEffect \uc911\ubcf5 \uc2e4\ud589 \ubb38\uc81c \ud574\uacb0"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["useEffect \uc758\uc874\uc131 \ucd5c\uc801\ud654 + useRef\ub85c ",(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ud398\uc774\uc9c0 \ub85c\ub529 70% \ub2e8\ucd95"})]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"0-\uac1c\uc694",children:"0. \uac1c\uc694"}),"\n",(0,t.jsx)(n.admonition,{title:"\ubb38\uc81c \uc0c1\ud669",type:"danger",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\uacb0\uc81c \ud398\uc774\uc9c0 \uc9c4\uc785 \uc2dc ",(0,t.jsx)(n.strong,{children:"Toss Payments Widget \ub85c\ub529\uc5d0 3~5\ucd08 \uc18c\uc694"})]}),"\n",(0,t.jsxs)(n.li,{children:["\ucfe0\ud3f0/\ud3ec\uc778\ud2b8 \ud560\uc778 \uc801\uc6a9 \uc2dc ",(0,t.jsx)(n.strong,{children:"\ud654\uba74\uc774 \uae5c\ube61\uc774\uba70 \uc7ac\ub80c\ub354\ub9c1"})]}),"\n",(0,t.jsxs)(n.li,{children:["\uac04\ud5d0\uc801\uc73c\ub85c ",(0,t.jsx)(n.strong,{children:'"\uacb0\uc81c \uc218\ub2e8\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694" \uc5d0\ub7ec'})," \ubc1c\uc0dd"]}),"\n"]})}),"\n",(0,t.jsx)(n.admonition,{title:"\ud574\uacb0 \ubc29\ud5a5",type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"useEffect \uc758\uc874\uc131 \ubc30\uc5f4 \ucd5c\uc801\ud654"}),": SDK \ucd08\uae30\ud654\ub294 \ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uae08\uc561 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc810 \ubcc0\uacbd"}),": \uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad \u2192 \uc11c\ubc84 \uc751\ub2f5 \ud6c4 1\ud68c\ub9cc"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"useRef\ub85c \uc778\uc2a4\ud134\uc2a4 \uad00\ub9ac"}),": \ub9ac\ub80c\ub354\ub9c1 \uc5c6\uc774 SDK \uac1d\uccb4 \uc720\uc9c0"]}),"\n"]})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"1-\ubb38\uc81c-\uc9c4\ub2e8",children:"1. \ubb38\uc81c \uc9c4\ub2e8"}),"\n",(0,t.jsx)(n.h3,{id:"as-is-\ubb38\uc81c\uac00-\ub418\uc5c8\ub358-\ucf54\ub4dc-\uad6c\uc870",children:"AS-IS: \ubb38\uc81c\uac00 \ub418\uc5c8\ub358 \ucf54\ub4dc \uad6c\uc870"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// pages/PaymentPage.jsx (\uac1c\uc120 \uc804)\r\nconst PaymentPage = () => {\r\n  const [totalPrice, setTotalPrice] = useState(0);\r\n  const [salePrice, setSalePrice] = useState(0);\r\n  const [usedPoint, setUsedPoint] = useState(0);\r\n\r\n  const paymentRequest = () => {\r\n    const paymentWidget = paymentWidgetRef.current;\r\n    requestPayment(cartId, couponId, paymentWidget, usedPoint);\r\n  };\r\n\r\n  // \ubb38\uc81c 1: SDK \uad00\ub828 \uac12\uc744 useEffect \uc758\uc874\uc131\uc5d0 \ud3ec\ud568\r\n  useEffect(() => {\r\n    (async () => {\r\n      const paymentWidget = await loadPaymentWidget(clientKey, customerKey);\r\n      // SDK \ucd08\uae30\ud654 + \uc704\uc82f \ub80c\ub354\ub9c1\r\n    })();\r\n  }, [totalPrice, salePrice, usedPoint]); // \u274c \uae08\uc561 \ubcc0\uacbd \uc2dc\ub9c8\ub2e4 \uc7ac\ucd08\uae30\ud654\r\n\r\n  // \ubb38\uc81c 2: \uae08\uc561 \uc5c5\ub370\uc774\ud2b8 useEffect\uac00 \ubcc4\ub3c4\ub85c \uc874\uc7ac\r\n  useEffect(() => {\r\n    const paymentMethodsWidget = paymentMethodsWidgetRef.current;\r\n    if (paymentMethodsWidget == null) return;\r\n\r\n    paymentMethodsWidget.updateAmount(\r\n      Math.max(totalPrice - salePrice - usedPoint, 0)\r\n    );\r\n  }, [totalPrice, salePrice, usedPoint]); // \u274c \uae08\uc561 \ubcc0\uacbd \uc2dc\ub9c8\ub2e4 \uc2e4\ud589\r\n\r\n  return \uacb0\uc81c\ud558\uae30;\r\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'// hooks/useRequestPayment (\uac1c\uc120 \uc804)\r\nconst useRequestPayment = () => {\r\n  const requestPayment = async (cartId, couponId, paymentWidget, point) => {\r\n    try {\r\n      const response = await api.post("/api/payments/prepare", {\r\n        cartId,\r\n        couponId,\r\n        point,\r\n      });\r\n\r\n      // Toss \uacb0\uc81c\ucc3d \ud638\ucd9c\r\n      paymentWidget?.requestPayment(response.data);\r\n    } catch (error) {\r\n      console.error("\uacb0\uc81c \uc2e4\ud328:", error);\r\n    }\r\n  };\r\n\r\n  return requestPayment;\r\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ubb38\uc81c\uc810"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uae08\uc561 \uad00\ub828 state\uac00 useEffect \uc758\uc874\uc131 \ubc30\uc5f4\uc5d0 \ud3ec\ud568"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ucfe0\ud3f0 \uc801\uc6a9 \u2192 ",(0,t.jsx)(n.code,{children:"salePrice"})," \ubcc0\uacbd \u2192 useEffect \uc2e4\ud589 \u2192 SDK \uc7ac\ucd08\uae30\ud654 \u2192 \ud654\uba74 \uae5c\ube61\uc784"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ub450 \uac1c\uc758 useEffect\uac00 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SDK \ucd08\uae30\ud654 useEffect + \uae08\uc561 \uc5c5\ub370\uc774\ud2b8 useEffect \u2192 Race Condition \ubc1c\uc0dd \uac00\ub2a5"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad \uc804\uc5d0 \uae08\uc561 \uc5c5\ub370\uc774\ud2b8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\uc11c\ubc84 \uac80\uc99d \uc804\uc5d0 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \uae08\uc561 \uacc4\uc0b0 \u2192 \ubd88\uc77c\uce58 \uac00\ub2a5\uc131"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2-\ud574\uacb0-\uacfc\uc815",children:"2. \ud574\uacb0 \uacfc\uc815"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-useeffect-\uc758\uc874\uc131-\ubc30\uc5f4-\ucd5c\uc801\ud654",children:"Step 1: useEffect \uc758\uc874\uc131 \ubc30\uc5f4 \ucd5c\uc801\ud654"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'// pages/PaymentPage.jsx (\uac1c\uc120 \ud6c4)\r\nconst PaymentPage = () => {\r\n  const paymentWidgetRef = useRef(null);\r\n  const paymentMethodsWidgetRef = useRef(null);\r\n\r\n  const paymentRequest = () => {\r\n    const paymentWidget = paymentWidgetRef.current;\r\n    const paymentMethodsWidget = paymentMethodsWidgetRef.current;\r\n\r\n    requestPayment(\r\n      cartId,\r\n      couponId,\r\n      paymentWidget,\r\n      paymentMethodsWidget,\r\n      usedPoint\r\n    );\r\n  };\r\n\r\n  // SDK \ucd08\uae30\ud654 (\ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc)\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const paymentWidget = await loadPaymentWidget(clientKey, customerKey);\r\n        paymentWidgetRef.current = paymentWidget;\r\n\r\n        const paymentMethodsWidget = paymentWidget.renderPaymentMethods(\r\n          "#payment-widget",\r\n          { value: totalPrice }\r\n        );\r\n        paymentMethodsWidgetRef.current = paymentMethodsWidget;\r\n      } catch (error) {\r\n        console.error("SDK \ucd08\uae30\ud654 \uc2e4\ud328:", error);\r\n      }\r\n    })();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []); // \u2705 \uc758\uc874\uc131 \ubc30\uc5f4 \ube44\uc6c0 \u2192 \ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc \uc2e4\ud589\r\n\r\n  return \uacb0\uc81c\ud558\uae30;\r\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud575\uc2ec \uac1c\uc120"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 useEffect \uc758\uc874\uc131 \ubc30\uc5f4\uc744 \ube44\uc6c0 (",(0,t.jsx)(n.code,{children:"[]"}),") \u2192 ",(0,t.jsx)(n.strong,{children:"\ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc \uc2e4\ud589"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 SDK \uc778\uc2a4\ud134\uc2a4\ub97c ",(0,t.jsx)(n.code,{children:"useRef"}),"\uc5d0 \uc800\uc7a5 \u2192 ",(0,t.jsx)(n.strong,{children:"\ub9ac\ub80c\ub354\ub9c1 \uc5c6\uc774 \uac12 \uc720\uc9c0"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 \uae08\uc561 \uc5c5\ub370\uc774\ud2b8 useEffect \uc81c\uac70 \u2192 ",(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad \uc2dc\uc810\uc73c\ub85c \uc774\ub3d9"})]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"step-2-\uae08\uc561-\uc5c5\ub370\uc774\ud2b8-\uc2dc\uc810-\ubcc0\uacbd",children:"Step 2: \uae08\uc561 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc810 \ubcc0\uacbd"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'// hooks/useRequestPayment (\uac1c\uc120 \ud6c4)\r\nconst useRequestPayment = () => {\r\n  const requestPayment = async (\r\n    cartId,\r\n    couponId,\r\n    paymentWidget,\r\n    paymentMethodsWidget,\r\n    point\r\n  ) => {\r\n    try {\r\n      // 1. \uc11c\ubc84\uc5d0 \uacb0\uc81c \uc815\ubcf4 \uc804\uc1a1\r\n      const response = await api.post("/api/payments/prepare", {\r\n        cartId,\r\n        couponId,\r\n        point,\r\n      });\r\n\r\n      // 2. \uc11c\ubc84\uac00 \uacc4\uc0b0\ud55c \ucd5c\uc885 \uae08\uc561\uc73c\ub85c \uc704\uc82f \uc5c5\ub370\uc774\ud2b8\r\n      paymentMethodsWidget.updateAmount(Math.max(response.data.amount, 0));\r\n\r\n      // 3. Toss \uacb0\uc81c\ucc3d \ud638\ucd9c\r\n      paymentWidget?.requestPayment(response.data);\r\n    } catch (error) {\r\n      console.error("\uacb0\uc81c \uc2e4\ud328:", error);\r\n    }\r\n  };\r\n\r\n  return requestPayment;\r\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud575\uc2ec \uac1c\uc120"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"\uc11c\ubc84 \uc751\ub2f5 \ud6c4 \uae08\uc561 \uc5c5\ub370\uc774\ud2b8"})," \u2192 \ud074\ub77c\uc774\uc5b8\ud2b8-\uc11c\ubc84 \uae08\uc561 \uc77c\uce58 \ubcf4\uc7a5"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad \uc2dc 1\ud68c\ub9cc updateAmount \ud638\ucd9c"})," \u2192 Race Condition \uc81c\uac70"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"paymentMethodsWidget"}),"\uc744 \ud568\uaed8 \uc804\ub2ec \u2192 SDK \ud638\ucd9c \uc548\uc815\ud654"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3-\uac1c\uc120-\ud6a8\uacfc",children:"3. \uac1c\uc120 \ud6a8\uacfc"}),"\n",(0,t.jsx)(n.h3,{id:"\uc131\ub2a5-\ube44\uad50",children:"\uc131\ub2a5 \ube44\uad50"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\ud56d\ubaa9"}),(0,t.jsx)(n.th,{children:"Before"}),(0,t.jsx)(n.th,{children:"After"}),(0,t.jsx)(n.th,{children:"\uac1c\uc120\uc728"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ud398\uc774\uc9c0 \ub85c\ub529"})}),(0,t.jsx)(n.td,{children:"3~5\ucd08"}),(0,t.jsx)(n.td,{children:"1\ucd08"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\uc57d 70% \u2193"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"useEffect \uc2e4\ud589 \ud69f\uc218"})}),(0,t.jsx)(n.td,{children:"8~12\ud68c"}),(0,t.jsx)(n.td,{children:"1\ud68c"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\uc57d 90% \u2193"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\ud654\uba74 \uae5c\ube61\uc784"})}),(0,t.jsx)(n.td,{children:"\u2705 \ubc1c\uc0dd"}),(0,t.jsx)(n.td,{children:"\u274c \uc81c\uac70"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"100% \uac1c\uc120"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:'"\uacb0\uc81c \uc218\ub2e8 \uc120\ud0dd" \uc5d0\ub7ec'})}),(0,t.jsx)(n.td,{children:"\uac04\ud5d0\uc801 \ubc1c\uc0dd"}),(0,t.jsx)(n.td,{children:"\u274c \ud574\uacb0"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"100% \uac1c\uc120"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\uc2dc\ub098\ub9ac\uc624\ubcc4-useeffect-\uc2e4\ud589-\ud69f\uc218",children:"\uc2dc\ub098\ub9ac\uc624\ubcc4 useEffect \uc2e4\ud589 \ud69f\uc218"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\uc791\uc5c5 \ud750\ub984"}),(0,t.jsx)(n.th,{children:"Before"}),(0,t.jsx)(n.th,{children:"After"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\ud398\uc774\uc9c0 \uc9c4\uc785"}),(0,t.jsx)(n.td,{children:"2\ud68c (\ucd08\uae30\ud654 + \uae08\uc561 \uc5c5\ub370\uc774\ud2b8)"}),(0,t.jsx)(n.td,{children:"1\ud68c (\ucd08\uae30\ud654\ub9cc)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\ucfe0\ud3f0 \uc801\uc6a9"}),(0,t.jsx)(n.td,{children:"+2\ud68c (\uc7ac\ucd08\uae30\ud654 + \uae08\uc561 \uc5c5\ub370\uc774\ud2b8)"}),(0,t.jsx)(n.td,{children:"0\ud68c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\ud3ec\uc778\ud2b8 \uc801\uc6a9"}),(0,t.jsx)(n.td,{children:"+2\ud68c"}),(0,t.jsx)(n.td,{children:"0\ud68c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\ucfe0\ud3f0 \ubcc0\uacbd"}),(0,t.jsx)(n.td,{children:"+2\ud68c"}),(0,t.jsx)(n.td,{children:"0\ud68c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\ucd1d\uacc4"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"8~12\ud68c"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"1\ud68c"})})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4-\ud575\uc2ec-\ud3ec\uc778\ud2b8",children:"4. \ud575\uc2ec \ud3ec\uc778\ud2b8"}),"\n",(0,t.jsx)(n.h3,{id:"1\ufe0f\u20e3-useeffect-\uc758\uc874\uc131-\uad00\ub9ac",children:"1\ufe0f\u20e3 useEffect \uc758\uc874\uc131 \uad00\ub9ac"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// \u274c \uc798\ubabb\ub41c \uc608\uc2dc\r\nuseEffect(() => {\r\n  // SDK \ucd08\uae30\ud654\r\n}, [totalPrice, salePrice, usedPoint]);\r\n\r\n// \u2705 \uc62c\ubc14\ub978 \uc608\uc2dc\r\nuseEffect(() => {\r\n  // SDK \ucd08\uae30\ud654 (\ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc)\r\n}, []);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\uc6d0\uce59"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uc678\ubd80 \ub77c\uc774\ube0c\ub7ec\ub9ac \ucd08\uae30\ud654"}),": \ub9c8\uc6b4\ud2b8 \uc2dc 1\ud68c\ub9cc (",(0,t.jsx)(n.code,{children:"useEffect([])"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uc0c1\ud0dc \uc5c5\ub370\uc774\ud2b8"}),": \uc774\ubca4\ud2b8 \ud578\ub4e4\ub7ec \ub610\ub294 API \uc751\ub2f5 \ud6c4 \ucc98\ub9ac"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\uc758\uc874\uc131 \ubc30\uc5f4"}),": \uc815\ub9d0 \ud544\uc694\ud55c \uac12\ub9cc \ud3ec\ud568"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"2\ufe0f\u20e3-useref\uc758-\uc62c\ubc14\ub978-\ud65c\uc6a9",children:"2\ufe0f\u20e3 useRef\uc758 \uc62c\ubc14\ub978 \ud65c\uc6a9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// \u274c \uc798\ubabb\ub41c \uc608\uc2dc (state \uc0ac\uc6a9)\r\nconst [paymentWidget, setPaymentWidget] = useState(null);\r\n// \u2192 \ub9ac\ub80c\ub354\ub9c1 \ubc1c\uc0dd\r\n\r\n// \u2705 \uc62c\ubc14\ub978 \uc608\uc2dc (useRef \uc0ac\uc6a9)\r\nconst paymentWidgetRef = useRef(null);\r\npaymentWidgetRef.current = paymentWidget;\r\n// \u2192 \ub9ac\ub80c\ub354\ub9c1 \uc5c6\uc774 \uac12 \uc720\uc9c0\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"useRef \uc0ac\uc6a9 \uc2dc\uae30"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 \ub9ac\ub80c\ub354\ub9c1\uc744 \uc720\ubc1c\ud558\uc9c0 \uc54a\uc544\uc57c \ud558\ub294 \uac12"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 \uc678\ubd80 \ub77c\uc774\ube0c\ub7ec\ub9ac \uc778\uc2a4\ud134\uc2a4"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 DOM \uc5d8\ub9ac\uba3c\ud2b8 \ucc38\uc870"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"3\ufe0f\u20e3-\ube44\ub3d9\uae30-\uc791\uc5c5-\uc21c\uc11c-\uad00\ub9ac",children:"3\ufe0f\u20e3 \ube44\ub3d9\uae30 \uc791\uc5c5 \uc21c\uc11c \uad00\ub9ac"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[\uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad]\r\n      \u2193\r\n[1. \uc11c\ubc84\uc5d0 \uacb0\uc81c \uc815\ubcf4 \uc804\uc1a1]\r\n      \u2193\r\n[2. \uc11c\ubc84\uac00 \ucd5c\uc885 \uae08\uc561 \uacc4\uc0b0 \ubc0f \uac80\uc99d]\r\n      \u2193\r\n[3. updateAmount(\uc11c\ubc84 \uae08\uc561)]\r\n      \u2193\r\n[4. requestPayment(\uacb0\uc81c\ucc3d \ud638\ucd9c)]\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\uc6d0\uce59"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"\uc11c\ubc84\uac00 \ucd5c\uc885 \uae08\uc561\uc744 \uacc4\uc0b0"})," \u2192 \ud074\ub77c\uc774\uc5b8\ud2b8-\uc11c\ubc84 \uae08\uc561 \uc77c\uce58"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"\ube44\ub3d9\uae30 \uc791\uc5c5\uc740 \uc21c\ucc28\uc801\uc73c\ub85c \ucc98\ub9ac"})," \u2192 Race Condition \ubc29\uc9c0"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"\ub2e8\uc77c \uc9c4\uc785\uc810"}),"(\uacb0\uc81c \ubc84\ud2bc)\uc5d0\uc11c \ubaa8\ub4e0 \uc791\uc5c5 \uc81c\uc5b4"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"5-\ucd94\uac00-\uac1c\uc120\uc0ac\ud56d",children:"5. \ucd94\uac00 \uac1c\uc120\uc0ac\ud56d"}),"\n",(0,t.jsx)(n.h3,{id:"\uc5d0\ub7ec-\ucc98\ub9ac-\uac15\ud654",children:"\uc5d0\ub7ec \ucc98\ub9ac \uac15\ud654"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const useRequestPayment = () => {\r\n  const requestPayment = async (...) => {\r\n    try {\r\n      const response = await api.post('/api/payments/prepare', {\r\n        cartId,\r\n        couponId,\r\n        point\r\n      });\r\n\r\n      // \uae08\uc561 \uc74c\uc218 \uccb4\ud06c\r\n      if (response.data.amount < 0) {\r\n        throw new Error('\uacb0\uc81c \uae08\uc561\uc774 0\uc6d0 \ubbf8\ub9cc\uc785\ub2c8\ub2e4.');\r\n      }\r\n\r\n      paymentMethodsWidget.updateAmount(response.data.amount);\r\n      paymentWidget?.requestPayment(response.data);\r\n\r\n    } catch (error) {\r\n      // \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc5d0\ub7ec \uba54\uc2dc\uc9c0\r\n      if (error.response?.status === 400) {\r\n        alert('\ucfe0\ud3f0 \ub610\ub294 \ud3ec\uc778\ud2b8 \uc0ac\uc6a9\uc774 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.');\r\n      } else {\r\n        alert('\uacb0\uc81c \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.');\r\n      }\r\n\r\n      console.error('\uacb0\uc81c \uc2e4\ud328:', error);\r\n    }\r\n  };\r\n\r\n  return requestPayment;\r\n};\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"6-\uacb0\ub860",children:"6. \uacb0\ub860"}),"\n",(0,t.jsx)(n.admonition,{title:"\uc131\uacfc",type:"success",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Toss SDK \ucd08\uae30\ud654\uc640 \uacb0\uc81c \ub85c\uc9c1\uc744 ",(0,t.jsx)(n.strong,{children:"\ub9c8\uc6b4\ud2b8 1\ud68c + \uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad \uc2dc \uae08\uc561 \uc5c5\ub370\uc774\ud2b8"})," \uad6c\uc870\ub85c \ubcc0\uacbd"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"useEffect \uc758\uc874\uc131 \ucd5c\uc801\ud654 + useRef\uc758 \uc62c\ubc14\ub978 \ud65c\uc6a9"}),"\uc73c\ub85c \ubd88\ud544\uc694\ud55c \ub9ac\ub80c\ub354\ub9c1 \uc81c\uac70"]}),"\n",(0,t.jsxs)(n.li,{children:["\uacb0\uacfc\uc801\uc73c\ub85c ",(0,t.jsx)(n.strong,{children:"\uacb0\uc81c \ud398\uc774\uc9c0 \ub85c\ub529 \uc2dc\uac04 \ub2e8\ucd95, \ud654\uba74 \uae5c\ube61\uc784 \uc81c\uac70, Race Condition \ubc1c\uc0dd \uac00\ub2a5\uc131 \uc81c\uac70"})]}),"\n"]})}),"\n",(0,t.jsx)(n.admonition,{title:"\ubc30\uc6b4 \uc810",type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"useEffect \uc758\uc874\uc131 \uad00\ub9ac\uc758 \uc911\uc694\uc131"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\uc678\ubd80 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub294 React\uc758 \ub80c\ub354\ub9c1 \uc0ac\uc774\ud074\uacfc \ubd84\ub9ac\ud574\uc11c \uad00\ub9ac"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ube44\ub3d9\uae30 \uc791\uc5c5\uacfc Race Condition \ucc98\ub9ac \uacbd\ud5d8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ub450 \uac1c\uc758 useEffect\uac00 \ub3d9\uc2dc\uc5d0 \uc2e4\ud589\ub418\uba74 ",(0,t.jsx)(n.strong,{children:"\uacbd\ud569 \uc870\uac74"})," \ubc1c\uc0dd \uac00\ub2a5"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ub2e8\uc77c \uc9c4\uc785\uc810"}),"(\uacb0\uc81c \ubc84\ud2bc \ud074\ub9ad)\uc5d0\uc11c \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc21c\ucc28\uc801\uc73c\ub85c \ucc98\ub9ac"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"useRef\uc758 \ud65c\uc6a9"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\ub9ac\ub80c\ub354\ub9c1\uc744 \uc720\ubc1c\ud558\uc9c0 \uc54a\uc73c\uba74\uc11c \uac12\uc744 \uc720\uc9c0\ud574\uc57c \ud560 \ub54c useRef \uc0ac\uc6a9"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"7-\ucc38\uace0-\uc790\ub8cc",children:"7. \ucc38\uace0 \uc790\ub8cc"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.tosspayments.com/reference/widget-sdk",children:"Toss Payments - React \uc5f0\ub3d9 \uac00\uc774\ub4dc"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react.dev/reference/react/useEffect",children:"React - useEffect"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react.dev/reference/react/useRef",children:"React - useRef"})}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,n,r){r.d(n,{R:()=>d,x:()=>c});var s=r(6540);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);